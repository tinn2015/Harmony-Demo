"use strict";(self.webpackChunkweb_join=self.webpackChunkweb_join||[]).push([[817],{27307:function(ut,Me,g){g.d(Me,{Yd:function(){return z},lS:function(){return Tt},qE:function(){return It},yQ:function(){return jt}});var Je=g(96695),h=g.n(Je),Ve=g(25098),k=g.n(Ve),Ne=g(19632),ve=g.n(Ne),ge=g(5574),x=g.n(ge),oe=g(15009),ue=g.n(oe),Ce=g(28785),we=g.n(Ce),J=g(48374),E=g.n(J),Ke=g(31996),Ee=g.n(Ke),Qe=g(26037),Ie=g.n(Qe),ke=g(12444),Fe=g.n(ke),We=g(72004),ze=g.n(We),K=g(54146),tt=g(30767);function ce(w,v,y,d){return new(y||(y=Promise))(function(p,_){function I($){try{S(d.next($))}catch(M){_(M)}}function T($){try{S(d.throw($))}catch(M){_(M)}}function S($){var M;$.done?p($.value):(M=$.value,M instanceof y?M:new y(function(B){B(M)})).then(I,T)}S((d=d.apply(w,v||[])).next())})}function ct(){return localStorage.getItem("QN_sdk_udid")}var he;typeof SuppressedError=="function"&&SuppressedError,function(w){w[w.DEBUG=0]="DEBUG",w[w.INFO=1]="INFO",w[w.WARNING=2]="WARNING",w[w.ERROR=3]="ERROR",w[w.NONE=4]="NONE"}(he||(he={}));var ae={DEBUG:he.DEBUG,INFO:he.INFO,WARNING:he.WARNING,ERROR:he.ERROR,NONE:he.NONE},P="qn-client",z=function(){function w(v){Fe()(this,w),this.default_val="",this.logLevel=ae.DEBUG,this.default_val=v?"".concat(P,":").concat(v):"".concat(P)}return ze()(w,[{key:"debug",value:function(){for(var y=arguments.length,d=new Array(y),p=0;p<y;p++)d[p]=arguments[p];this._log.apply(this,[ae.DEBUG].concat(d))}},{key:"info",value:function(){for(var y=arguments.length,d=new Array(y),p=0;p<y;p++)d[p]=arguments[p];this._log.apply(this,[ae.INFO].concat(d))}},{key:"warning",value:function(){for(var y=arguments.length,d=new Array(y),p=0;p<y;p++)d[p]=arguments[p];this._log.apply(this,[ae.WARNING].concat(d))}},{key:"error",value:function(){for(var y=arguments.length,d=new Array(y),p=0;p<y;p++)d[p]=arguments[p];this._log.apply(this,[ae.ERROR].concat(d))}},{key:"setLogLevel",value:function(y){this.logLevel=Math.min(Math.max(0,y),4)}},{key:"_log",value:function(){for(var y=arguments.length,d=new Array(y),p=0;p<y;p++)d[p]=arguments[p];var _=Math.min(Math.max(0,d[0]),4);if(_>=this.logLevel){var I="".concat(function(){var T=new Date;return"".concat(T.toTimeString().split(" ")[0],":").concat(T.getMilliseconds())}()," %c [").concat(this.default_val,"]:");switch(_){case ae.DEBUG:d=[I,"color: #64B5F6;"].concat(d.slice(1)),console.log.apply(console,d);break;case ae.INFO:d=[I,"color: #1E88E5; font-weight: bold;"].concat(d.slice(1)),console.log.apply(console,d);break;case ae.WARNING:d=[I,"color: #FB8C00; font-weight: bold;"].concat(d.slice(1)),console.warn.apply(console,d);break;case ae.ERROR:d=[I,"color: #B00020; font-weight: bold;"].concat(d.slice(1)),console.error.apply(console,d)}}}}]),w}(),q=new z("EnhancedEventEmitter"),Q=function(w){Ee()(y,w);var v=Ie()(y);function y(){return Fe()(this,y),v.call(this)}return ze()(y,[{key:"emit",value:function(p){for(var _,I=arguments.length,T=new Array(I>1?I-1:0),S=1;S<I;S++)T[S-1]=arguments[S];return(_=we()(E()(y.prototype),"emit",this)).call.apply(_,[this,p].concat(T))}},{key:"safeEmit",value:function(p){var _=we()(E()(y.prototype),"listenerCount",this).call(this,p);q.info("numListeners ---- %o",_);try{for(var I,T=arguments.length,S=new Array(T>1?T-1:0),$=1;$<T;$++)S[$-1]=arguments[$];return(I=we()(E()(y.prototype),"emit",this)).call.apply(I,[this,p].concat(S))}catch(M){return q.error("safeEmit() | event listener threw an error [eventName:%s]:%o",p,M),!!_}}},{key:"on",value:function(p,_){return we()(E()(y.prototype),"on",this).call(this,p,_),this}},{key:"off",value:function(p,_){return we()(E()(y.prototype),"off",this).call(this,p,_),this}},{key:"addListener",value:function(p,_){return we()(E()(y.prototype),"on",this).call(this,p,_),this}},{key:"once",value:function(p,_){return we()(E()(y.prototype),"once",this).call(this,p,_),this}},{key:"removeListener",value:function(p,_){return we()(E()(y.prototype),"off",this).call(this,p,_),this}},{key:"removeAllListeners",value:function(p){return q.debug("removeAllListeners() | \u91CA\u653E\u5168\u90E8\u76D1\u542C"),we()(E()(y.prototype),"removeAllListeners",this).call(this,p),this}},{key:"listenerCount",value:function(p){return we()(E()(y.prototype),"listenerCount",this).call(this,p)}},{key:"listeners",value:function(p){return we()(E()(y.prototype),"listeners",this).call(this,p)}}]),y}(K.v),U=new z("MediaDevice"),j;(function(w){w.IDLE="IDLE",w.INITING="INITING",w.INITEND="INITEND"})(j||(j={}));var C=new z("QnPeerConnection"),de=null,qe={v:[{name:"session",reg:/^(\d*)$/,names:["version"]}],o:[{name:"session",names:["origin"]}],s:[{name:"session",names:["name"]}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"session",names:["timing"]}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"]}],m:[{name:"kind",reg:/^(\w*)/}],a:[{push:"codecs",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payloadType","mimeType","clockRate","channels"]},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"]},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"]},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) (.*)/,names:["payload","type"]},{push:"extmaps",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"]},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"]},{name:"dtlsParameters",reg:/^setup:(\w*)/,names:["role"]},{name:"connectionType",reg:/^connection:(new|existing)/},{name:"mid",reg:/^mid:([^\s]*)/},{name:"msid",reg:/^msid:(.*)/},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceParameters",reg:/^ice-ufrag:(\S*)/,names:["usernameFragment"]},{name:"iceParameters",reg:/^ice-pwd:(\S*)/,names:["password"]},{push:"fingerprints",reg:/^fingerprint:(\S*) (\S*)/,names:["algorithm","value"]},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"]},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/},{name:"iceParameters",reg:/^ice-options:(.*)/,names:["iceOptions"]},{push:"encodings",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["ssrc","attribute","value"]},{name:"rtcp",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:[]},{push:"encodings",reg:/^ssrc-group:FID ([(\w+)]*) ([(\w+)]*)/,names:["ssrc","rtx"]},{name:"session",reg:/^msid-semantic:\s?(\w*)/,names:["msidSemantic"]},{name:"session",reg:/^group:(.*)/,names:["group"]},{name:"rtcp",reg:/^(rtcp-mux)/,names:["mux"]},{name:"rtcp",reg:/^(rtcp-rsize)/,names:["reducedSize"]},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"]},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"]}]};function mt(){return Object.keys(qe).forEach(function(w){qe[w].forEach(function(v){v.reg||(v.reg=/(.*)/)})}),qe}var re,$e;(function(w){w["urn:ietf:params:rtp-hdrext:sdes:mid"]="MID",w["urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"]="RTP_STREAM_ID",w["urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"]="REPAIRED_RTP_STREAM_ID",w["http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"]="ABS_SEND_TIME",w["http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"]="TRANSPORT_WIDE_CC_01",w["http://tools.ietf.org/html/draft-ietf-avtext-framemarking-07"]="FRAME_MARKING_07",w["urn:ietf:params:rtp-hdrext:framemarking"]="FRAME_MARKING",w["urn:ietf:params:rtp-hdrext:ssrc-audio-level"]="SSRC_AUDIO_LEVEL",w["urn:3gpp:video-orientation"]="VIDEO_ORIENTATION",w["urn:ietf:params:rtp-hdrext:toffset"]="TOFFSET"})(re||(re={})),function(w){w.UNKNOWN="0 unknown",w.MID="1 urn:ietf:params:rtp-hdrext:sdes:mid",w.RTP_STREAM_ID="2 urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",w.REPAIRED_RTP_STREAM_ID="3 urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",w.ABS_SEND_TIME="4 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",w.TRANSPORT_WIDE_CC_01="5 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",w.FRAME_MARKING_07="6 http://tools.ietf.org/html/draft-ietf-avtext-framemarking-07",w.FRAME_MARKING="7 urn:ietf:params:rtp-hdrext:framemarking",w.SSRC_AUDIO_LEVEL="10 urn:ietf:params:rtp-hdrext:ssrc-audio-level",w.VIDEO_ORIENTATION="11 urn:3gpp:video-orientation",w.TOFFSET="12 urn:ietf:params:rtp-hdrext:toffset",w.ABS_CAPTURE_TIME="13 "}($e||($e={}));var xe=new Map([["PCMU",["PCMU",0,-1]],["PCMA",["PCMA",8,-1]],["opus",["opus",111,-1]],["VP8",["VP8",96,97]],["VP9",["VP9",98,99]],["H264",["H264",100,101]],["H264H",["H264",102,103]],["H265",["H265",102,103]]]),wt=new Map([["sendonly",{producing:!0,consuming:!1}],["recvonly",{producing:!1,consuming:!0}],["sendrecv",{producing:!0,consuming:!0}]]),Ot=new Map([["client","active"],["server","passive"],["auto","actpass"]]),Rt=function(v){if(typeof v=="string")return v.split("/")},ft=function(v){return Object.entries(v).map(function(y){var d=_slicedToArray(y,2),p=d[0],_=d[1];return"".concat(p,"=").concat(_)}).join(";")},At=function(v){return Object.keys(v).length===0},pt=function(v){v=v||32;for(var y="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",d="",p=0;p<v;p++)d+=y.charAt(Math.floor(48*Math.random()));return d},W,Ht=RegExp.prototype.test.bind(/^([a-z])=(.*)/);function Mt(w){var v={},y=v,d=[],p=v,_=mt();w.split(/(\r\n|\r|\n)/).filter(Ht).forEach(function(M){var B=M[0],Y=M.slice(2);B==="m"&&(d.push({}),p=d[d.length-1]);for(var Z=0;Z<(_[B]||[]).length;Z+=1){var ne=_[B][Z];if(ne.reg.test(Y))return["iceParameters","dtlsParameters"].includes(ne.name)||ne.push==="fingerprints"?kt(ne,y,Y):kt(ne,p,Y)}});var I=function(M){if(M!=null&&M.session)return M==null?void 0:M.session}(v),T=function(M){var B,Y=[];return M.forEach(function(Z){var ne,X=function(H){var se=[];return H.codecs.forEach(function(V){var ee,be={},Se=((ee=H.fmtp.filter(function(Re){return V.payloadType===Re.payload}))===null||ee===void 0?void 0:ee[0])||void 0;Se&&(Se.config.split(";").forEach(function(Re){var nt=Re.split("=");be[nt[0]]=nt[1]}),V.parameters=be,se.push(V))}),se}(Z),te=function(H,se){var V={};return se&&se.forEach(function(ee){V[ee.payload]||(V[ee.payload]=[]),V[ee.payload].push(ee.type)}),H.forEach(function(ee){var be;ee.rtcpFbs=[],V[ee.payloadType]&&(be=ee.rtcpFbs).push.apply(be,_toConsumableArray(V[ee.payloadType]))}),H}(X,Z.rtcpFb),_e=function(H,se){var V=[];return se.forEach(function(ee){var be=ee.payloadType,Se=[],Re=ee.mimeType;Se=xe.get(Re)||void 0;var nt=Se&&V.some(function(Pe){return Pe.payloadType===Se[1]})||!1;xe.has(Re)&&!nt&&(ee.payloadType=Se[1],V.push(Object.assign(Object.assign({},ee),{mimeType:H+"/"+Re})),H==="video"&&se.forEach(function(Pe){var Et=Pe.mimeType,rr=Se&&V.some(function(vt){return vt.payloadType===Se[2]})||!1;Et==="rtx"&&!rr&&Pe.parameters.apt==be&&(Pe.payloadType=Se[2],Pe.parameters.apt=Se[1],V.push(Object.assign(Object.assign({},Pe),{mimeType:H+"/"+Et})))}))}),V}(Z.kind,te),Te=function(H){var se=[];return H.map(function(V){var ee=re[V.uri];ee!==void 0&&se.push(ee)}),se}(Z.extmaps);Z.encodings&&(ne=function(H){var se={ssrc:H[0].ssrc};if(H[0].rtx){var V={ssrc:H[0].rtx};se.rtx=V}return[se]}(Z.encodings));var fe=function(H,se){var V=H&&H.filter(function(be){return be.attribute==="cname"})[0],ee={};return(V==null?void 0:V.attribute)==="cname"&&(ee.cname=V.value||""),se.mux&&(ee.mux=!0),se.reducedSize&&(ee.reducedSize=!0),ee}(Z.encodings,Z.rtcp);B=wt.get(Z.direction),Y.push({kind:Z.kind,rtpParameters:{codecs:_e,extmaps:Te,encodings:ne,rtcp:fe,direction:B,msid:Z.msid||"",mid:Z.mid}})}),{new_medias:Y,direction:B}}(d),S=function(M){var B,Y,Z=(B=M.dtlsParameters)===null||B===void 0?void 0:B.role,ne={iceParameters:{iceLite:!0,iceOptions:M.iceParameters.iceOptions,password:M.iceParameters.password,usernameFragment:M.iceParameters.usernameFragment},dtlsParameters:{fingerprints:_toConsumableArray(M.fingerprints),role:Z==="actpass"?"auto":Z==="active"?"client":"server"}};return!((Y=M==null?void 0:M.iceParameters)===null||Y===void 0)&&Y.usernameFragment||(delete ne.iceParameters.iceLite,delete ne.iceParameters.usernameFragment),ne}(v),$={medias:T.new_medias,session:I,transport:Object.assign(Object.assign({},S),T.direction)};return Promise.resolve($)}function kt(w,v,y){var d=w.name&&w.names;w.push&&!v[w.push]?v[w.push]=[]:d&&!v[w.name]&&(v[w.name]={});var p=w.push?{}:d?v[w.name]:v;(function(_,I,T,S){if(S&&!T)I[S]=S==="mid"?_[1]:Ze(_[1]);else for(var $=0;$<T.length;$+=1)_[$+1]!=null&&(I[T[$]]=Ze(_[$+1]))})(y.match(w.reg),p,w.names,w.name),w.push&&v[w.push].push(p)}function Ze(w){return String(Number(w))===w?Number(w):w}function yt(w){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"pull";W="";var y=w.transport,d=w.session,p=w.medias;return function(_){Object.keys(_).forEach(function(I){st[I](_[I])})}(d),function(_,I){var T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"pull";_.forEach(function(S){var $,M,B,Y,Z,ne,X;(function(te){var _e=te.kind,Te=te.rtpParameters.codecs,fe=Te.map(function(H){return H.payloadType}).join(" ");W+="m="+_e+" 9 UDP/TLS/RTP/SAVPF "+fe+`\r
`})(S),W+=`c=IN IP4 0.0.0.0\r
`,T==="push"&&(W+=`b=AS:700\r
`),W+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,function(te){Object.keys(dt).forEach(function(_e){dt[_e](te)})}(I),W+="a=mid:"+S.rtpParameters.mid+`\r
`,S.rtpParameters.extmaps.forEach(function(te){W+="a=extmap:"+$e[te]+`\r
`}),function(te,_e){te&&_e&&(W+=`a=sendrecv\r
`),!te&&_e&&(W+=`a=sendonly\r
`),te&&!_e&&(W+=`a=recvonly\r
`)}(I.consuming,I.producing),!(($=S==null?void 0:S.rtpParameters)===null||$===void 0)&&$.msid&&(W+="a=msid:"+S.rtpParameters.msid+`\r
`),!((B=(M=S==null?void 0:S.rtpParameters)===null||M===void 0?void 0:M.rtcp)===null||B===void 0)&&B.mux&&(W+=`a=rtcp-mux\r
`),!((Z=(Y=S==null?void 0:S.rtpParameters)===null||Y===void 0?void 0:Y.rtcp)===null||Z===void 0)&&Z.reducedSize&&(W+=`a=rtcp-rsize\r
`),function(te,_e){var Te=te.codecs;Te.forEach(function(fe){var H=Rt(fe.mimeType),se="a=rtpmap:"+fe.payloadType+" "+H[1]+"/"+fe.clockRate;fe.channels&&(se=se+"/"+fe.channels),W+=se+`\r
`,function(V,ee,be){var Se="";V!=null&&V.rtcpFbs&&(Se="a=rtcp-fb:"+V.payloadType+" ",V.rtcpFbs.forEach(function(Re){var nt=Se+Re+" ";Re==="transport-cc"&&ee==="video"&&be==="push"&&(nt+="x-google-max-bitrate=200;x-google-min-bitrate=100;x-google-start-bitrate=150"),W+=nt+`\r
`}))}(fe,H[0],_e),function(V,ee,be){if(V!=null&&V.parameters){var Se=ft(V.parameters);W+="a=fmtp:"+V.payloadType+" "+Se+`\r
`,be==="push"&&ee==="video"&&(W+="a=fmtp:"+V.payloadType+` x-google-min-bitrate=300\r
`,W+="a=fmtp:"+V.payloadType+` x-google-max-bitrate=700\r
`)}}(fe,H[0],_e)})}(S.rtpParameters,T),!((ne=S==null?void 0:S.rtpParameters)===null||ne===void 0)&&ne.encodings&&function(te){var _e=te.encodings,Te=te.rtcp,fe=te.msid;_e.forEach(function(H){var se,V,ee=[];H!=null&&H.ssrc&&(!((se=H==null?void 0:H.rtx)===null||se===void 0)&&se.ssrc)&&(W+="a=ssrc-group:FID "+H.ssrc+" "+H.rtx.ssrc+`\r
`),H!=null&&H.ssrc&&ee.push(H.ssrc),!((V=H==null?void 0:H.rtx)===null||V===void 0)&&V.ssrc&&ee.push(H.rtx.ssrc);var be=fe==null?void 0:fe.split(" ");ee.forEach(function(Se){var Re="a=ssrc:"+Se+" ";W+=Re+"cname:"+Te.cname+`\r
`,W+=Re+"msid:"+fe+`\r
`,fe&&(W+=Re+"mslabel:"+be[0]+`\r
`,W+=Re+"label:"+be[1]+`\r
`)})})}(S.rtpParameters),!((X=I==null?void 0:I.iceCandidates)===null||X===void 0)&&X.length&&I.iceCandidates.forEach(function(te){if(At(te))return"";var _e=te.foundation,Te=te.ip,fe=te.port,H=te.priority,se=te.protocol,V=te.type;W+="a=candidate:"+_e+" 1 "+se+" "+H+" "+Te+" "+fe+" typ "+V+`\r
`})})}(p,y,v),W}var st={version:function(v){W+="v="+v+`\r
`},origin:function(v){W+="o="+v+`\r
`},name:function(v){W+="s="+v+`\r
`},timing:function(v){W+="t="+v+`\r
`},group:function(v){W+="a=group:"+v+`\r
`,W+=`a=extmap-allow-mixed\r
`},msidSemantic:function(v){W+="a=msid-semantic: "+v+`\r
`}},dt={usernameFragment:function(v){var y=v.iceParameters,d=y.iceLite,p=y.usernameFragment;d&&p&&(W+="a=ice-ufrag:"+p+`\r
`)},password:function(v){var y=v.iceParameters.password;y&&(W+="a=ice-pwd:"+y+`\r
`)},iceOptions:function(v){var y=v.iceParameters.iceOptions;y&&(W+="a=ice-options:"+y+`\r
`)},fingerprints:function(v){var y=v.dtlsParameters.fingerprints[0],d=y.algorithm,p=y.value;W+="a=fingerprint:"+d+" "+p+`\r
`},role:function(v){var y=v.dtlsParameters.role,d=Ot.get(y);d&&(W+="a=setup:"+d+`\r
`)}},lt=g(96486),Gt=null,Jt=null,Ye=new z("QnTransport"),Nt=null,Vt=function(v){return new Nt(v)},St=new z("QnWebSocket"),bt;(function(w){w.IDEL="IDEL",w.CONNECTING="CONNECTING",w.CONNECTED="CONNECTED",w.DISCONNECTED="DISCONNECTED",w.RECONNECTION="RECONNECTION",w.FAILED="FAILED",w.CLOSED="CLOSED"})(bt||(bt={}));var Kt=null,Qt,xt=new z("Consumer"),Ct;(function(w){w.START="START",w.SUNSCRIBE_ING="SUNSCRIBE_ING",w.SUNSCRIBE_SUCCED="SUNSCRIBE_SUCCED",w.SUNSCRIBE_FAILED="SUNSCRIBE_FAILED",w.CLOSED="CLOSED"})(Ct||(Ct={}));var ar=null,qt=new z("Producer"),Zt=null,Xt=new z("QnClient"),zt=null,Lt=null,Yt=null,rt=new z("GenerateMediaStream"),er=function(v){return ce(void 0,void 0,void 0,_regeneratorRuntime().mark(function y(){var d;return _regeneratorRuntime().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(rt.debug("createCustomAudioTrack()"),!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)){_.next=5;break}return _.next=3,navigator.mediaDevices.getUserMedia({audio:v});case 3:return d=_.sent,_.abrupt("return",Promise.resolve(d.getAudioTracks()[0]));case 5:return _.abrupt("return",Promise.reject({message:"The current browser does not support this feature",name:"NotSupportedError"}));case 6:case"end":return _.stop()}},y)}))},It=function(v){return ce(void 0,void 0,void 0,ue()().mark(function y(){var d;return ue()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(rt.debug("createCustomVideoTrack() | constraints ",v),!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)){_.next=5;break}return _.next=3,navigator.mediaDevices.getUserMedia({video:v});case 3:return d=_.sent,_.abrupt("return",Promise.resolve(d.getVideoTracks()[0]));case 5:return _.abrupt("return",Promise.reject({message:"The current browser does not support this feature",name:"NotSupportedError"}));case 6:case"end":return _.stop()}},y)}))},tr=function(v){return ce(void 0,void 0,void 0,_regeneratorRuntime().mark(function y(){return _regeneratorRuntime().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(rt.debug("createMediaStream()"),rt.debug("createMediaStream() | constraints : ",v),new Promise(function(_,I){navigator.mediaDevices.getUserMedia(v).then(function(T){_(T)}).catch(function(T){return rt.error("[createMediaStream] [ERROR]: "+T),I({message:"The current browser does not support this feature",name:"NotSupportedError"})})})));case 1:case"end":return p.stop()}},y)}))},Tt=function(v){return ce(void 0,void 0,void 0,ue()().mark(function y(){return ue()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(rt.debug("createShareStream()"),new Promise(function(_,I){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return navigator.mediaDevices.getDisplayMedia(v).then(function(T){_(T)}).catch(function(T){rt.error("createShareStream() | error",T),I(T)});I({message:"The current browser does not support this feature",name:"NotSupportedError"})})));case 1:case"end":return p.stop()}},y)}))},jt=new(function(w){Ee()(y,w);var v=Ie()(y);function y(){var d;return Fe()(this,y),d=v.call(this),d.state=j.IDLE,d.deviceInfoMap=new Map,d.initMediaDevices().then(function(){navigator.mediaDevices&&navigator.mediaDevices.addEventListener("devicechange",d.updateDevice.bind(k()(d)))}).catch(function(p){return U.error(p)}),d}return ze()(y,[{key:"initMediaDevices",value:function(){return ce(this,void 0,void 0,ue()().mark(function p(){return ue()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return this.state=j.INITING,I.prev=1,I.next=4,this.updateDevice();case 4:this.state=j.INITEND,I.next=13;break;case 7:if(I.prev=7,I.t0=I.catch(1),U.debug("Device Detection functionality cannot start properly.",I.t0),this.state=j.IDLE,!(typeof isSecureContext=="boolean"&&!isSecureContext)){I.next=11;break}throw new Error("Your context is limited by web security, please try using https protocol or localhost.");case 11:if(!(!["https:","file:"].includes(location.protocol)&&!["localhost","127.0.0.1","::1"].includes(location.hostname))){I.next=13;break}throw new Error("Your context is limited by web security, please try using https protocol or localhost.");case 13:case"end":return I.stop()}},p,this,[[1,7]])}))}},{key:"enumerateDevices",value:function(p,_){var I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return ce(this,void 0,void 0,ue()().mark(function T(){var S,$,M,B,Y,Z;return ue()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)){X.next=2;break}return X.abrupt("return",void U.error("Obtaining device information is not supported"));case 2:return X.next=4,navigator.mediaDevices.enumerateDevices();case 4:if(S=X.sent,$=this.checkMediaDeviceInfoIsOk(S),M=p&&!$.audio,B=_&&!$.video,Y=null,!(I&&(M||B))){X.next=17;break}return X.prev=8,X.next=11,navigator.mediaDevices.getUserMedia({audio:M,video:B});case 11:Y=X.sent,X.next=17;break;case 14:X.prev=14,X.t0=X.catch(8),this.handleError(X.t0);case 17:return X.prev=17,X.next=20,navigator.mediaDevices.enumerateDevices();case 20:return Z=X.sent,X.abrupt("return",(Y&&(Y.getTracks().forEach(function(te){return te.stop()}),Y=null),Z));case 24:X.prev=24,X.t1=X.catch(17),this.handleError(X.t1);case 27:case"end":return X.stop()}},T,this,[[8,14],[17,24]])}))}},{key:"checkMediaDeviceInfoIsOk",value:function(p){var _=p.filter(function(ne){return ne.kind==="audioinput"}),I=p.filter(function(ne){return ne.kind==="videoinput"}),T={audio:!1,video:!1},S=h()(_),$;try{for(S.s();!($=S.n()).done;){var M=$.value;if(M.label&&M.deviceId){T.audio=!0;break}}}catch(ne){S.e(ne)}finally{S.f()}var B=h()(I),Y;try{for(B.s();!(Y=B.n()).done;){var Z=Y.value;if(Z.label&&Z.deviceId){T.video=!0;break}}}catch(ne){B.e(ne)}finally{B.f()}return T}},{key:"handleError",value:function(p){U.error(p.name+":"+p.message)}},{key:"getCameraDevices",value:function(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return ce(this,void 0,void 0,ue()().mark(function _(){return ue()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,this.enumerateDevices(!1,!0,p);case 2:return T.abrupt("return",T.sent.filter(function(S){return S.kind==="videoinput"}));case 3:case"end":return T.stop()}},_,this)}))}},{key:"getAudioInputDevices",value:function(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return ce(this,void 0,void 0,ue()().mark(function _(){return ue()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,this.enumerateDevices(!0,!1,p);case 2:return T.abrupt("return",T.sent.filter(function(S){return S.kind==="audioinput"}));case 3:case"end":return T.stop()}},_,this)}))}},{key:"getAudioOutputDevices",value:function(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return ce(this,void 0,void 0,ue()().mark(function _(){return ue()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,this.enumerateDevices(!0,!1,p);case 2:return T.abrupt("return",T.sent.filter(function(S){return S.kind==="audiooutput"}));case 3:case"end":return T.stop()}},_,this)}))}},{key:"updateDevice",value:function(){return ce(this,void 0,void 0,ue()().mark(function p(){var _=this,I,T,S;return ue()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,this.enumerateDevices(!0,!0,!0);case 2:I=M.sent,T=Date.now(),S=[],I.forEach(function(B){if(B.deviceId){var Y=_.deviceInfoMap.get(B.deviceId);if(Y&&Y.state==="CONNECTED")Y&&(Y.updateAt=T);else{var Z={initAt:T,updateAt:T,device:B,state:"CONNECTED"};_.deviceInfoMap.set(B.deviceId,Z),S.push(Z)}}}),this.deviceInfoMap.forEach(function(B){B.state==="CONNECTED"&&B.updateAt!==T&&(B.state="DISCONNECTED",S.push(B))}),this.state===j.INITEND&&S.forEach(function(B){_.emit("MEDIA_DEVICE_CHANGED",B.device.kind,B.device.deviceId)});case 6:case"end":return M.stop()}},p,this)}))}}]),y}(Q))},84183:function(ut,Me,g){var Je=g(15009),h=g.n(Je),Ve=g(99289),k=g.n(Ve),Ne=g(5574),ve=g.n(Ne),ge=g(19092),x=g(94848),oe=g(67294),ue=g(23089),Ce=g(79095),we=g(17740),J=g(85893),E=function(Ee){var Qe=Ee.deviceType,Ie=(0,we.R)(Ce.Uh),ke=(0,oe.useState)(Ie.speakerDevice.deviceId||"system"),Fe=ve()(ke,2),We=Fe[0],ze=Fe[1],K=(0,oe.useState)(JSON.stringify(Ie.videoRatio)||JSON.stringify({width:640,height:360})),tt=ve()(K,2),ce=tt[0],ct=tt[1];(0,oe.useEffect)(function(){he(),ae(),P()},[]);var he=function(){var z=k()(h()().mark(function q(){var Q;return h()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,(0,ue.XM)("audioinput");case 2:Q=j.sent,(0,Ce.qj)(Q);case 4:case"end":return j.stop()}},q)}));return function(){return z.apply(this,arguments)}}(),ae=function(){var z=k()(h()().mark(function q(){var Q;return h()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,(0,ue.XM)("audiooutput");case 2:Q=j.sent,(0,Ce.Rv)(Q);case 4:case"end":return j.stop()}},q)}));return function(){return z.apply(this,arguments)}}(),P=function(){var z=k()(h()().mark(function q(){var Q;return h()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,(0,ue.XM)("videoinput");case 2:Q=j.sent,(0,Ce.dg)(Q);case 4:case"end":return j.stop()}},q)}));return function(){return z.apply(this,arguments)}}();return(0,J.jsx)(J.Fragment,{children:Qe==="audio"?(0,J.jsxs)(J.Fragment,{children:[(0,J.jsxs)("div",{className:ge.Z.device_selected_inner,children:[(0,J.jsx)("div",{className:ge.Z.device_selected_inner_title,children:"\u9EA6\u514B\u98CE"}),(0,J.jsxs)(x.Z,{value:Ie.audiodeviceId||"system",popupClassName:ge.Z.deviceSelectedOptions,onClick:function(q){q.preventDefault(),q.stopPropagation()},onChange:function(q){console.log("[DeviceSelected] : onChange() | mic | value : "+q),(0,Ce.Cv)(q)},children:[(0,J.jsx)(x.Z.Option,{children:(0,J.jsx)("div",{children:"\u8DDF\u968F\u7CFB\u7EDF"})},"system"),Ie.audioInputDevices.map(function(z){return(0,J.jsx)(x.Z.Option,{children:(0,J.jsx)("div",{children:z.label})},z.deviceId)})]})]}),(0,J.jsxs)("div",{className:ge.Z.device_selected_inner,children:[(0,J.jsx)("div",{className:ge.Z.device_selected_inner_title,children:"\u626C\u58F0\u5668"}),(0,J.jsxs)(x.Z,{value:We||"system",popupClassName:ge.Z.deviceSelectedOptions,onClick:function(q){q.preventDefault(),q.stopPropagation()},onChange:function(q){ze(q),(0,Ce.nO)(q)},children:[(0,J.jsx)(x.Z.Option,{children:(0,J.jsx)("div",{children:"\u8DDF\u968F\u7CFB\u7EDF"})},"system"),Ie.audioOutputDevices.map(function(z){return(0,J.jsx)(x.Z.Option,{children:(0,J.jsx)("div",{children:z.label})},z.deviceId)})]})]})]}):(0,J.jsx)(J.Fragment,{children:(0,J.jsxs)("div",{className:ge.Z.device_selected_inner,children:[(0,J.jsx)("div",{className:ge.Z.device_selected_inner_title,children:"\u6444\u50CF\u5934"}),(0,J.jsxs)(x.Z,{value:Ie.videodeviceId||"system",popupClassName:ge.Z.deviceSelectedOptions,onClick:function(q){q.preventDefault(),q.stopPropagation()},onChange:function(q){console.log("[DeviceSelected] : onChange() | camera | value : "+q),(0,Ce.Ns)(q)},children:[(0,J.jsx)(x.Z.Option,{children:(0,J.jsx)("div",{children:"\u8DDF\u968F\u7CFB\u7EDF"})},"system"),Ie.videoInputDevices.map(function(z){return(0,J.jsx)(x.Z.Option,{children:(0,J.jsx)("div",{children:z.label})},z.deviceId)})]})]})})})};Me.Z=E},59642:function(ut,Me,g){g.d(Me,{Z:function(){return ge}});var Je=g(5574),h=g.n(Je),Ve=g(39452),k=g(67294),Ne=g(85893),ve=function(oe){var ue=oe.ChildrenNode,Ce=oe.title,we=oe.open,J=oe.hancleCloseModal,E=oe.handleSubmit,Ke=(0,k.useState)(we),Ee=h()(Ke,2),Qe=Ee[0],Ie=Ee[1];console.log("[UniversalPopupWrapper]: exit_conference | isOpen : "+Qe);var ke=function(){console.log("[UniversalPopupWrapper]: handleClose() | "),Ie(!1),J&&J()};return(0,Ne.jsx)(Ve.Z,{closeIcon:!1,open:Qe,title:Ce,wrapClassName:"update-panel",footer:null,onCancel:ke,children:(0,Ne.jsx)(ue,{handleClose:ke,hanldeClick:E})})},ge=ve},56324:function(ut,Me,g){g.d(Me,{Tb:function(){return h}});var Je=function(k){return k.START="START",k.SUNSCRIBE_ING="SUNSCRIBE_ING",k.SUNSCRIBE_SUCCED="SUNSCRIBE_SUCCED",k.SUNSCRIBE_FAILED="SUNSCRIBE_FAILED",k.CLOSED="CLOSED",k}({}),h=function(k){return k.IDEL="IDEL",k.CONNECTING="CONNECTING",k.CONNECTED="CONNECTED",k.DISCONNECTED="DISCONNECTED",k.RECONNECTION="RECONNECTION",k.FAILED="FAILED",k.CLOSED="CLOSED",k}({}),Ve=function(k){return k[k.DEBUG=0]="DEBUG",k[k.INFO=1]="INFO",k[k.WARNING=2]="WARNING",k[k.ERROR=3]="ERROR",k[k.NONE=4]="NONE",k}({})},56496:function(ut,Me,g){g.d(Me,{eX:function(){return kr},Kn:function(){return Sr},Sy:function(){return wr},zl:function(){return yr},Ls:function(){return br}});var Je=g(15009),h=g.n(Je),Ve=g(99289),k=g.n(Ve),Ne=g(6154),ve=g(81354),ge=g(98269),x=g.n(ge),oe=g(66419),ue=g(68214),Ce=g.n(ue),we=g(88010),J=g.n(we),E=g(60247),Ke=function(i){var u="";i.data&&(i.headers["Content-MD5"]=Ce()(JSON.stringify(i.data)).toString().toLowerCase(),u=i.headers["Content-MD5"]+`
`);var t=new Date().valueOf(),e=E.EA.account||void 0;i.headers["X-Sd-Account"]="".concat(e),i.headers["X-Sd-Apiver"]="1.0",i.headers["X-Sd-Nonce"]=(0,oe.O1)(32),i.headers["X-Sd-Timestamp"]=t;var r="".concat(i.method.toUpperCase(),`
/api`).concat(i.url,`
`).concat(u,`application/json
X-Sd-Account:`).concat(i.headers["X-Sd-Account"],`
X-Sd-Apiver:`).concat(i.headers["X-Sd-Apiver"],`
X-Sd-Nonce:`).concat(i.headers["X-Sd-Nonce"],`
X-Sd-Timestamp:`).concat(i.headers["X-Sd-Timestamp"],`
`);return r},Ee=Ne.Z.create({baseURL:"https://meeting.onlineinline.com/api",timeout:5e3});Ee.defaults.headers.post["Content-Type"]="application/json",Ee.interceptors.request.use(function(o){if(o.url==="/v1/auth/get/token")return o;if(console.log("[apipost-token]: user | ",E.EA),E.EA.token&&E.EA.account){var i=E.EA.token;return o.headers["X-Sd-Signature"]=x().stringify(J()(Ke(o),i)),console.log("[apipost-token]: _config |  ",o),o}else{var u=new Date,t=u.getFullYear(),e=u.getMonth()>8?u.getMonth()+1:"0".concat(u.getMonth()+1),r=Ce()("GeeDowTech_".concat(t).concat(e)).toString().toLowerCase();return o.headers["X-Sd-Signature"]=x().stringify(J()(Ke(o),r)),o}}),Ee.interceptors.response.use(function(o){var i=o.data;return i?i.errorCode===0?Promise.resolve(i):Promise.reject(i):Promise.reject(o)});var Qe=Ee,Ie=g(19632),ke=g.n(Ie),Fe=g(5574),We=g.n(Fe),ze=g(97857),K=g.n(ze),tt=g(12444),ce=g.n(tt),ct=g(72004),he=g.n(ct),ae=g(25098),P=g.n(ae),z=g(31996),q=g.n(z),Q=g(26037),U=g.n(Q),j=g(9783),C=g.n(j),de=g(96695),qe=g.n(de),mt=g(28785),re=g.n(mt),$e=g(48374),xe=g.n($e),wt=g(54146);function Ot(){var o=new Date;return"".concat(o.toTimeString().split(" ")[0],":").concat(o.getMilliseconds())}function Rt(){var o=new Date().getTime();window.performance&&typeof window.performance.now=="function"&&(o+=performance.now());var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var t=(o+Math.random()*16)%16|0;return o=Math.floor(o/16),(u=="x"?t:t&3|8).toString(16)});return i}function ft(){return localStorage.getItem("QN_sdk_udid")}function At(o){localStorage.setItem("QN_sdk_udid",o)}var pt=function(o){return o[o.DEBUG=0]="DEBUG",o[o.INFO=1]="INFO",o[o.WARNING=2]="WARNING",o[o.ERROR=3]="ERROR",o[o.NONE=4]="NONE",o}({}),W={DEBUG:pt.DEBUG,INFO:pt.INFO,WARNING:pt.WARNING,ERROR:pt.ERROR,NONE:pt.NONE};function Ht(o){for(var i in W)if(W[i]===o)return i;return"DEFAULT"}var Mt="qn-client",kt=function(){function o(i){ce()(this,o),C()(this,"logLevel",void 0),C()(this,"default_val",""),this.logLevel=W.DEBUG,i?this.default_val="".concat(Mt,":").concat(i):this.default_val="".concat(Mt)}return he()(o,[{key:"debug",value:function(){for(var u=arguments.length,t=new Array(u),e=0;e<u;e++)t[e]=arguments[e];this._log.apply(this,[W.DEBUG].concat(t))}},{key:"info",value:function(){for(var u=arguments.length,t=new Array(u),e=0;e<u;e++)t[e]=arguments[e];this._log.apply(this,[W.INFO].concat(t))}},{key:"warning",value:function(){for(var u=arguments.length,t=new Array(u),e=0;e<u;e++)t[e]=arguments[e];this._log.apply(this,[W.WARNING].concat(t))}},{key:"error",value:function(){for(var u=arguments.length,t=new Array(u),e=0;e<u;e++)t[e]=arguments[e];this._log.apply(this,[W.ERROR].concat(t))}},{key:"setLogLevel",value:function(u){this.logLevel=Math.min(Math.max(0,u),4)}},{key:"_log",value:function(){for(var u=arguments.length,t=new Array(u),e=0;e<u;e++)t[e]=arguments[e];var r=Math.min(Math.max(0,t[0]),4);if(r>=this.logLevel){var a="".concat(Ot()," %c [").concat(this.default_val,"]:");switch(r){case W.DEBUG:t=[a,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,t);break;case W.INFO:t=[a,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,t);break;case W.WARNING:t=[a,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,t);break;case W.ERROR:t=[a,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,t)}}}}]),o}(),Ze=kt,yt=new Ze("EnhancedEventEmitter"),st=function(o){q()(u,o);var i=U()(u);function u(){return ce()(this,u),i.call(this)}return he()(u,[{key:"emit",value:function(e){for(var r,a=arguments.length,n=new Array(a>1?a-1:0),s=1;s<a;s++)n[s-1]=arguments[s];return(r=re()(xe()(u.prototype),"emit",this)).call.apply(r,[this,e].concat(n))}},{key:"safeEmit",value:function(e){var r=re()(xe()(u.prototype),"listenerCount",this).call(this,e);yt.info("numListeners ---- %o",r);try{for(var a,n=arguments.length,s=new Array(n>1?n-1:0),c=1;c<n;c++)s[c-1]=arguments[c];return(a=re()(xe()(u.prototype),"emit",this)).call.apply(a,[this,e].concat(s))}catch(l){return yt.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,l),!!r}}},{key:"on",value:function(e,r){return re()(xe()(u.prototype),"on",this).call(this,e,r),this}},{key:"off",value:function(e,r){return re()(xe()(u.prototype),"off",this).call(this,e,r),this}},{key:"addListener",value:function(e,r){return re()(xe()(u.prototype),"on",this).call(this,e,r),this}},{key:"once",value:function(e,r){return re()(xe()(u.prototype),"once",this).call(this,e,r),this}},{key:"removeListener",value:function(e,r){return re()(xe()(u.prototype),"off",this).call(this,e,r),this}},{key:"removeAllListeners",value:function(e){return yt.debug("removeAllListeners() | \u91CA\u653E\u5168\u90E8\u76D1\u542C"),re()(xe()(u.prototype),"removeAllListeners",this).call(this,e),this}},{key:"listenerCount",value:function(e){return re()(xe()(u.prototype),"listenerCount",this).call(this,e)}},{key:"listeners",value:function(e){return re()(xe()(u.prototype),"listeners",this).call(this,e)}}]),u}(wt.v),dt=new Ze("MediaDevice"),lt=function(o){return o.IDLE="IDLE",o.INITING="INITING",o.INITEND="INITEND",o}(lt||{}),Gt=function(o){q()(u,o);var i=U()(u);function u(){var t;return ce()(this,u),t=i.call(this),C()(P()(t),"deviceInfoMap",void 0),C()(P()(t),"state",lt.IDLE),t.deviceInfoMap=new Map,t.initMediaDevices().then(function(){navigator.mediaDevices&&navigator.mediaDevices.addEventListener("devicechange",t.updateDevice.bind(P()(t)))}).catch(function(e){return dt.error(e)}),t}return he()(u,[{key:"initMediaDevices",value:function(){var t=k()(h()().mark(function r(){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.state=lt.INITING,n.prev=1,n.next=4,this.updateDevice();case 4:this.state=lt.INITEND,n.next=17;break;case 7:if(n.prev=7,n.t0=n.catch(1),dt.debug("Device Detection functionality cannot start properly.",n.t0),this.state=lt.IDLE,!(typeof isSecureContext=="boolean"&&!isSecureContext)){n.next=15;break}throw new Error("Your context is limited by web security, please try using https protocol or localhost.");case 15:if(["https:","file:"].includes(location.protocol)||["localhost","127.0.0.1","::1"].includes(location.hostname)){n.next=17;break}throw new Error("Your context is limited by web security, please try using https protocol or localhost.");case 17:case"end":return n.stop()}},r,this,[[1,7]])}));function e(){return t.apply(this,arguments)}return e}()},{key:"enumerateDevices",value:function(){var t=k()(h()().mark(function r(a,n){var s,c,l,m,f,b,D,R=arguments;return h()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(s=R.length>2&&R[2]!==void 0?R[2]:!0,!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)){O.next=4;break}return dt.error("Obtaining device information is not supported"),O.abrupt("return");case 4:return O.next=6,navigator.mediaDevices.enumerateDevices();case 6:if(c=O.sent,l=this.checkMediaDeviceInfoIsOk(c),m=a&&!l.audio,f=n&&!l.video,b=null,!(s&&(m||f))){O.next=21;break}return O.prev=12,O.next=15,navigator.mediaDevices.getUserMedia({audio:m,video:f});case 15:b=O.sent,O.next=21;break;case 18:O.prev=18,O.t0=O.catch(12),this.handleError(O.t0);case 21:return O.prev=21,O.next=24,navigator.mediaDevices.enumerateDevices();case 24:return D=O.sent,b&&(b.getTracks().forEach(function(F){return F.stop()}),b=null),O.abrupt("return",D);case 29:O.prev=29,O.t1=O.catch(21),this.handleError(O.t1);case 32:case"end":return O.stop()}},r,this,[[12,18],[21,29]])}));function e(r,a){return t.apply(this,arguments)}return e}()},{key:"checkMediaDeviceInfoIsOk",value:function(e){var r=e.filter(function(D){return D.kind==="audioinput"}),a=e.filter(function(D){return D.kind==="videoinput"}),n={audio:!1,video:!1},s=qe()(r),c;try{for(s.s();!(c=s.n()).done;){var l=c.value;if(l.label&&l.deviceId){n.audio=!0;break}}}catch(D){s.e(D)}finally{s.f()}var m=qe()(a),f;try{for(m.s();!(f=m.n()).done;){var b=f.value;if(b.label&&b.deviceId){n.video=!0;break}}}catch(D){m.e(D)}finally{m.f()}return n}},{key:"handleError",value:function(e){dt.error(e.name+":"+e.message)}},{key:"getCameraDevices",value:function(){var t=k()(h()().mark(function r(){var a,n,s=arguments;return h()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return a=s.length>0&&s[0]!==void 0?s[0]:!0,l.next=3,this.enumerateDevices(!1,!0,a);case 3:return n=l.sent,l.abrupt("return",n.filter(function(m){return m.kind==="videoinput"}));case 5:case"end":return l.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"getAudioInputDevices",value:function(){var t=k()(h()().mark(function r(){var a,n,s=arguments;return h()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return a=s.length>0&&s[0]!==void 0?s[0]:!0,l.next=3,this.enumerateDevices(!0,!1,a);case 3:return n=l.sent,l.abrupt("return",n.filter(function(m){return m.kind==="audioinput"}));case 5:case"end":return l.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"getAudioOutputDevices",value:function(){var t=k()(h()().mark(function r(){var a,n,s=arguments;return h()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return a=s.length>0&&s[0]!==void 0?s[0]:!0,l.next=3,this.enumerateDevices(!0,!1,a);case 3:return n=l.sent,l.abrupt("return",n.filter(function(m){return m.kind==="audiooutput"}));case 5:case"end":return l.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"updateDevice",value:function(){var t=k()(h()().mark(function r(){var a=this,n,s,c;return h()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.enumerateDevices(!0,!0,!0);case 2:n=m.sent,s=Date.now(),c=[],n.forEach(function(f){if(f.deviceId){var b=a.deviceInfoMap.get(f.deviceId);if(!b||b.state!=="CONNECTED"){var D={initAt:s,updateAt:s,device:f,state:"CONNECTED"};a.deviceInfoMap.set(f.deviceId,D),c.push(D)}else b&&(b.updateAt=s)}}),this.deviceInfoMap.forEach(function(f){f.state==="CONNECTED"&&f.updateAt!==s&&(f.state="DISCONNECTED",c.push(f))}),this.state===lt.INITEND&&c.forEach(function(f){a.emit("MEDIA_DEVICE_CHANGED",f.device.kind,f.device.deviceId)});case 8:case"end":return m.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()}]),u}(st),Jt=Gt,Ye=new Ze("QnPeerConnection"),Nt=function(){function o(i){var u=this;ce()(this,o),C()(this,"_pc",void 0),C()(this,"_direction",void 0),this._direction=i.direction,this._pc=new RTCPeerConnection({bundlePolicy:"max-bundle"}),this._pc.oniceconnectionstatechange=function(){Ye.info(u._direction+" | oniceconnectionstatechange() | iceConnectionState",u._pc.iceConnectionState)},this._pc.onconnectionstatechange=function(){Ye.info(u._direction+" | onconnectionstatechange() | connectionState",u._pc.connectionState)}}return he()(o,[{key:"useTransceiver",value:function(u,t){var e,r=u.direction,a=u.kind,n=r==="recvonly"?"receiver":"sender",s=(e=this._pc.getTransceivers().filter(function(c){var l,m;if(Ye.debug("useTransceiver | transceiver | ",c),c.direction==="inactive"&&((l=c[n])===null||l===void 0||(m=l.track)===null||m===void 0?void 0:m.kind)===a)return c.direction=r,c}))===null||e===void 0?void 0:e[0];Ye.debug(r+" : useTransceiver() | rtp_transceiver ",s),s||(s=this._pc.addTransceiver(a,{direction:r})),Ye.debug("allocation user transceiver"),t&&t(s)}},{key:"createOffers",value:function(){var i=k()(h()().mark(function t(){var e;return h()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this._pc.createOffer();case 2:return e=a.sent,Ye.debug("createOffers() | offers",e.sdp&&!0),a.abrupt("return",e);case 5:case"end":return a.stop()}},t,this)}));function u(){return i.apply(this,arguments)}return u}()},{key:"setRemoteAnswer",value:function(){var i=k()(h()().mark(function t(e){return h()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e){a.next=3;break}return Ye.error(" sdpAnswer cannot be empty ... ..."),a.abrupt("return",!1);case 3:return a.prev=3,a.next=6,this._pc.setRemoteDescription({type:"answer",sdp:e});case 6:return a.abrupt("return",!0);case 9:return a.prev=9,a.t0=a.catch(3),Ye.error("set remote description fail: ",a.t0),a.abrupt("return",!1);case 13:case"end":return a.stop()}},t,this,[[3,9]])}));function u(t){return i.apply(this,arguments)}return u}()},{key:"closePc",value:function(){this._pc.getTransceivers().forEach(function(u){var t,e,r,a;u.direction="inactive",u==null||(t=u.sender)===null||t===void 0||(e=t.track)===null||e===void 0||e.stop(),u==null||(r=u.receiver)===null||r===void 0||(a=r.track)===null||a===void 0||a.stop()}),this._pc.close(),Ye.info("pc closed")}}]),o}(),Vt=function(i){return new Nt({direction:i})},St={v:[{name:"session",reg:/^(\d*)$/,names:["version"]}],o:[{name:"session",names:["origin"]}],s:[{name:"session",names:["name"]}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"session",names:["timing"]}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"]}],m:[{name:"kind",reg:/^(\w*)/}],a:[{push:"codecs",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payloadType","mimeType","clockRate","channels"]},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"]},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"]},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) (.*)/,names:["payload","type"]},{push:"extmaps",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"]},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"]},{name:"dtlsParameters",reg:/^setup:(\w*)/,names:["role"]},{name:"connectionType",reg:/^connection:(new|existing)/},{name:"mid",reg:/^mid:([^\s]*)/},{name:"msid",reg:/^msid:(.*)/},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceParameters",reg:/^ice-ufrag:(\S*)/,names:["usernameFragment"]},{name:"iceParameters",reg:/^ice-pwd:(\S*)/,names:["password"]},{push:"fingerprints",reg:/^fingerprint:(\S*) (\S*)/,names:["algorithm","value"]},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"]},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/},{name:"iceParameters",reg:/^ice-options:(.*)/,names:["iceOptions"]},{push:"encodings",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["ssrc","attribute","value"]},{name:"rtcp",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:[]},{push:"encodings",reg:/^ssrc-group:FID ([(\w+)]*) ([(\w+)]*)/,names:["ssrc","rtx"]},{name:"session",reg:/^msid-semantic:\s?(\w*)/,names:["msidSemantic"]},{name:"session",reg:/^group:(.*)/,names:["group"]},{name:"rtcp",reg:/^(rtcp-mux)/,names:["mux"]},{name:"rtcp",reg:/^(rtcp-rsize)/,names:["reducedSize"]},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"]},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"]}]};function bt(){return Object.keys(St).forEach(function(o){var i=St[o];i.forEach(function(u){u.reg||(u.reg=/(.*)/)})}),St}var Kt=function(o){return o["urn:ietf:params:rtp-hdrext:sdes:mid"]="MID",o["urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"]="RTP_STREAM_ID",o["urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"]="REPAIRED_RTP_STREAM_ID",o["http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"]="ABS_SEND_TIME",o["http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"]="TRANSPORT_WIDE_CC_01",o["http://tools.ietf.org/html/draft-ietf-avtext-framemarking-07"]="FRAME_MARKING_07",o["urn:ietf:params:rtp-hdrext:framemarking"]="FRAME_MARKING",o["urn:ietf:params:rtp-hdrext:ssrc-audio-level"]="SSRC_AUDIO_LEVEL",o["urn:3gpp:video-orientation"]="VIDEO_ORIENTATION",o["urn:ietf:params:rtp-hdrext:toffset"]="TOFFSET",o}({}),Qt=function(o){return o.UNKNOWN="0 unknown",o.MID="1 urn:ietf:params:rtp-hdrext:sdes:mid",o.RTP_STREAM_ID="2 urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",o.REPAIRED_RTP_STREAM_ID="3 urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",o.ABS_SEND_TIME="4 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",o.TRANSPORT_WIDE_CC_01="5 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",o.FRAME_MARKING_07="6 http://tools.ietf.org/html/draft-ietf-avtext-framemarking-07",o.FRAME_MARKING="7 urn:ietf:params:rtp-hdrext:framemarking",o.SSRC_AUDIO_LEVEL="10 urn:ietf:params:rtp-hdrext:ssrc-audio-level",o.VIDEO_ORIENTATION="11 urn:3gpp:video-orientation",o.TOFFSET="12 urn:ietf:params:rtp-hdrext:toffset",o.ABS_CAPTURE_TIME="13 ",o}({}),xt=new Map([["PCMU",["PCMU",0,-1]],["PCMA",["PCMA",8,-1]],["opus",["opus",111,-1]],["VP8",["VP8",96,97]],["VP9",["VP9",98,99]],["H264",["H264",100,101]],["H264H",["H264",102,103]],["H265",["H265",102,103]]]),Ct=new Map([["sendonly",{producing:!0,consuming:!1}],["recvonly",{producing:!1,consuming:!0}],["sendrecv",{producing:!0,consuming:!0}]]),ar=new Map([["{ producing: true, consuming: false }","sendonly"],["{ producing: false, consuming: true }","recvonly"],["{ producing: true, consuming: true }","sendrecv"]]),qt=new Map([["client","active"],["server","passive"],["auto","actpass"]]),Zt=function(i){if(typeof i=="string")return i.split("/")},Xt=function(i){var u=Object.entries(i).map(function(t){var e=We()(t,2),r=e[0],a=e[1];return"".concat(r,"=").concat(a)}).join(";");return u},zt=function(i){return Object.keys(i).length===0},Lt=function(i){i=i||32;for(var u="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",t=u.length,e="",r=0;r<i;r++)e+=u.charAt(Math.floor(Math.random()*t));return e},Yt=function(i,u,t){var e=(i==null?void 0:i.medias)||[];e==null||e.forEach(function(r){var a,n=[],s=(r==null||(a=r.rtpParameters)===null||a===void 0?void 0:a.codecs)||[];s.forEach(function(c){var l=c==null?void 0:c.payloadType,m=(c==null?void 0:c.mimeType)||"",f=m.split("/");f.length>=2&&f[0]==="video"?u==""?n.push(c):u==f[1]&&(n.push(c),s.forEach(function(b){var D=b.mimeType||"",R=D.split("/");if(R.length>=2&&R[1]==="rtx"){var L=b.parameters.apt;L==l&&n.push(b)}})):f[0]=="audio"&&(t==""||t==f[1])&&n.push(c)}),n.length>0&&(r.rtpParameters.codecs=n)})},rt=RegExp.prototype.test.bind(/^([a-z])=(.*)/);function er(o){var i={},u=i,t=[],e=i,r=bt();o.split(/(\r\n|\r|\n)/).filter(rt).forEach(function(l){var m=l[0],f=l.slice(2);m==="m"&&(t.push({}),e=t[t.length-1]);for(var b=0;b<(r[m]||[]).length;b+=1){var D=r[m][b];if(D.reg.test(f))return["iceParameters","dtlsParameters"].includes(D.name)||D.push==="fingerprints"?It(D,u,f):It(D,e,f)}});var a=T(i),n=w(t),s=jt(i),c={medias:n.new_medias,session:a,transport:K()(K()({},s),n.direction)};return Promise.resolve(c)}function It(o,i,u){var t=o.name&&o.names;o.push&&!i[o.push]?i[o.push]=[]:t&&!i[o.name]&&(i[o.name]={});var e=o.push?{}:t?i[o.name]:i;tr(u.match(o.reg),e,o.names,o.name),o.push&&i[o.push].push(e)}function tr(o,i,u,t){if(t&&!u)i[t]=t==="mid"?o[1]:Tt(o[1]);else for(var e=0;e<u.length;e+=1)o[e+1]!=null&&(i[u[e]]=Tt(o[e+1]))}function Tt(o){return String(Number(o))===o?Number(o):o}function jt(o){var i,u,t=(i=o.dtlsParameters)===null||i===void 0?void 0:i.role,e={iceParameters:{iceLite:!0,iceOptions:o.iceParameters.iceOptions,password:o.iceParameters.password,usernameFragment:o.iceParameters.usernameFragment},dtlsParameters:{fingerprints:ke()(o.fingerprints),role:t==="actpass"?"auto":t==="active"?"client":"server"}};return o!=null&&(u=o.iceParameters)!==null&&u!==void 0&&u.usernameFragment||(delete e.iceParameters.iceLite,delete e.iceParameters.usernameFragment),e}function w(o){var i=[],u;return o.forEach(function(t){var e=v(t),r=y(e,t.rtcpFb),a=I(t.kind,r),n=d(t.extmaps),s;t.encodings&&(s=p(t.encodings));var c=_(t.encodings,t.rtcp);u=Ct.get(t.direction),i.push({kind:t.kind,rtpParameters:{codecs:a,extmaps:n,encodings:s,rtcp:c,direction:u,msid:t.msid||"",mid:t.mid}})}),{new_medias:i,direction:u}}function v(o){var i=[];return o.codecs.forEach(function(u){var t,e={},r=((t=o.fmtp.filter(function(n){return u.payloadType===n.payload}))===null||t===void 0?void 0:t[0])||void 0;if(r){var a=r.config.split(";");a.forEach(function(n){var s=n.split("=");e[s[0]]=s[1]}),u.parameters=e,i.push(u)}}),i}function y(o,i){var u=/{payload: (\d+), type: '([^']+)'}/g,t={};return i&&i.forEach(function(e){t[e.payload]||(t[e.payload]=[]),t[e.payload].push(e.type)}),o.forEach(function(e){var r;e.rtcpFbs=[],t[e.payloadType]&&(r=e.rtcpFbs).push.apply(r,ke()(t[e.payloadType]))}),o}function d(o){var i=[];return o.map(function(u){var t=Kt[u.uri];t!==void 0&&i.push(t)}),i}function p(o){var i={ssrc:o[0].ssrc};if(o[0].rtx){var u={ssrc:o[0].rtx};i.rtx=u}return[i]}function _(o,i){var u=o&&o.filter(function(e){return e.attribute==="cname"})[0],t={};return(u==null?void 0:u.attribute)==="cname"&&(t.cname=u.value||""),i.mux&&(t.mux=!0),i.reducedSize&&(t.reducedSize=!0),t}function I(o,i){var u=[];return i.forEach(function(t){var e=t.payloadType,r=[],a=t.mimeType;r=xt.get(a)||void 0;var n=r&&u.some(function(s){return s.payloadType===r[1]})||!1;xt.has(a)&&!n&&(t.payloadType=r[1],u.push(K()(K()({},t),{},{mimeType:o+"/"+a})),o==="video"&&i.forEach(function(s){var c=s.mimeType,l=r&&u.some(function(f){return f.payloadType===r[2]})||!1;if(c==="rtx"&&!l){var m=s.parameters.apt;m==e&&(s.payloadType=r[2],s.parameters.apt=r[1],u.push(K()(K()({},s),{},{mimeType:o+"/"+c})))}}))}),u}function T(o){if(o!=null&&o.session)return o==null?void 0:o.session}var S;function $(o){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"pull";S="";var u=o.transport,t=o.session,e=o.medias;return M(t),Y(e,u,i),S}function M(o){Object.keys(o).forEach(function(i){B[i](o[i])})}var B={version:function(i){S+="v="+i+`\r
`},origin:function(i){S+="o="+i+`\r
`},name:function(i){S+="s="+i+`\r
`},timing:function(i){S+="t="+i+`\r
`},group:function(i){S+="a=group:"+i+`\r
`,S+=`a=extmap-allow-mixed\r
`},msidSemantic:function(i){S+="a=msid-semantic: "+i+`\r
`}};function Y(o,i){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"pull";o.forEach(function(t){var e,r,a,n,s,c,l;Z(t),S+=`c=IN IP4 0.0.0.0\r
`,u==="push"&&(S+=`b=AS:700\r
`),S+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,ne(i),S+="a=mid:"+t.rtpParameters.mid+`\r
`,te(t.rtpParameters.extmaps),_e(i.consuming,i.producing),t!=null&&(e=t.rtpParameters)!==null&&e!==void 0&&e.msid&&(S+="a=msid:"+t.rtpParameters.msid+`\r
`),t!=null&&(r=t.rtpParameters)!==null&&r!==void 0&&(a=r.rtcp)!==null&&a!==void 0&&a.mux&&(S+=`a=rtcp-mux\r
`),t!=null&&(n=t.rtpParameters)!==null&&n!==void 0&&(s=n.rtcp)!==null&&s!==void 0&&s.reducedSize&&(S+=`a=rtcp-rsize\r
`),Te(t.rtpParameters,u),!(t==null||(c=t.rtpParameters)===null||c===void 0)&&c.encodings&&se(t.rtpParameters),i!=null&&(l=i.iceCandidates)!==null&&l!==void 0&&l.length&&V(i.iceCandidates)})}function Z(o){var i=o.kind,u=o.rtpParameters.codecs,t=u.map(function(r){return r.payloadType}),e=t.join(" ");S+="m="+i+" 9 UDP/TLS/RTP/SAVPF "+e+`\r
`}function ne(o){var i=Object.keys(X);i.forEach(function(u){X[u](o)})}var X={usernameFragment:function(i){var u=i.iceParameters,t=u.iceLite,e=u.usernameFragment;t&&e&&(S+="a=ice-ufrag:"+e+`\r
`)},password:function(i){var u=i.iceParameters.password;u&&(S+="a=ice-pwd:"+u+`\r
`)},iceOptions:function(i){var u=i.iceParameters.iceOptions;u&&(S+="a=ice-options:"+u+`\r
`)},fingerprints:function(i){var u=i.dtlsParameters.fingerprints[0],t=u.algorithm,e=u.value;S+="a=fingerprint:"+t+" "+e+`\r
`},role:function(i){var u=i.dtlsParameters.role,t=qt.get(u);t&&(S+="a=setup:"+t+`\r
`)}};function te(o){o.forEach(function(i){S+="a=extmap:"+Qt[i]+`\r
`})}function _e(o,i){o&&i&&(S+=`a=sendrecv\r
`),!o&&i&&(S+=`a=sendonly\r
`),o&&!i&&(S+=`a=recvonly\r
`)}function Te(o,i){var u=o.codecs;u.forEach(function(t){var e=Zt(t.mimeType),r="a=rtpmap:"+t.payloadType+" "+e[1]+"/"+t.clockRate;t.channels&&(r=r+"/"+t.channels),S+=r+`\r
`,fe(t,e[0],i),H(t,e[0],i)})}function fe(o,i,u){var t="";o!=null&&o.rtcpFbs&&(t="a=rtcp-fb:"+o.payloadType+" ",o.rtcpFbs.forEach(function(e){var r=t+e+" ";e==="transport-cc"&&i==="video"&&u==="push"&&(r+="x-google-max-bitrate=200;x-google-min-bitrate=100;x-google-start-bitrate=150"),S+=r+`\r
`}))}function H(o,i,u){if(o!=null&&o.parameters){var t=Xt(o.parameters);S+="a=fmtp:"+o.payloadType+" "+t+`\r
`,u==="push"&&i==="video"&&(S+="a=fmtp:"+o.payloadType+` x-google-min-bitrate=300\r
`,S+="a=fmtp:"+o.payloadType+` x-google-max-bitrate=700\r
`)}}function se(o){var i=o.encodings,u=o.rtcp,t=o.msid;i.forEach(function(e){var r,a,n=[];e!=null&&e.ssrc&&e!==null&&e!==void 0&&(r=e.rtx)!==null&&r!==void 0&&r.ssrc&&(S+="a=ssrc-group:FID "+e.ssrc+" "+e.rtx.ssrc+`\r
`),e!=null&&e.ssrc&&n.push(e.ssrc),e!=null&&(a=e.rtx)!==null&&a!==void 0&&a.ssrc&&n.push(e.rtx.ssrc);var s=t==null?void 0:t.split(" ");n.forEach(function(c){var l="a=ssrc:"+c+" ";S+=l+"cname:"+u.cname+`\r
`,S+=l+"msid:"+t+`\r
`,t&&(S+=l+"mslabel:"+s[0]+`\r
`,S+=l+"label:"+s[1]+`\r
`)})})}function V(o){o.forEach(function(i){if(zt(i))return"";var u=i.foundation,t=i.ip,e=i.port,r=i.priority,a=i.protocol,n=i.type;S+="a=candidate:"+u+" 1 "+a+" "+r+" "+t+" "+e+" typ "+n+`\r
`})}var ee=g(96486),be=function(){function o(i){ce()(this,o),C()(this,"_json_offer",null),C()(this,"mid_answer_media",{}),C()(this,"answer_transport_",{})}return he()(o,[{key:"setLocalSDPOffer",value:function(u){this._json_offer=(u==null?void 0:u.sdp_offer)||{}}},{key:"addRemoteSdpAnswer",value:function(u){var t=this,e=u;if(e!=null&&e.transportParams)this.answer_transport_=e.transportParams;else if(e!=null&&e.dtlsParameters)return this.answer_transport_=e,!0;return e!=null&&e.mediaParams&&e.mediaParams.forEach(function(r){var a,n=(r==null||(a=r.rtpParameters)===null||a===void 0?void 0:a.mid)||r.mid;n&&(t.mid_answer_media[n]=r)}),!0}},{key:"removeRemoteJsonAnswer",value:function(u){var t=this;u.forEach(function(e){t.mid_answer_media[e]&&delete t.mid_answer_media[e]})}},{key:"createRemoteSdpAnswer",value:function(u){var t,e,r,a=this,n=ee.cloneDeep(this._json_offer),s=this._json_offer.transport,c=s.producing,l=s.consuming;n.transport=this.answer_transport_,n.transport.producing=l,n.transport.consuming=c,!u&&(t=n.transport)!==null&&t!==void 0&&t.iceCandidates&&delete n.transport.iceCandidates,n.transport.iceParameters.iceOptions=s.iceParameters.iceOptions;var m=n==null||(e=n.transport)===null||e===void 0||(r=e.dtlsParameters)===null||r===void 0?void 0:r.role;return n.transport.dtlsParameters.role=m==="server"?"server":"client",n==null||n.medias.forEach(function(f){var b,D,R=(f==null||(b=f.rtpParameters)===null||b===void 0?void 0:b.mid)||"",L=null;if(L=a.mid_answer_media["".concat(R)],L){var O,F,ie;f.rtpParameters.encodings=((O=L)===null||O===void 0||(F=O.rtpParameters)===null||F===void 0?void 0:F.encodings)||((ie=L)===null||ie===void 0?void 0:ie.encodings)}var A=f.rtpParameters.rtcp.cname;(A==""||!A)&&(f.rtpParameters.rtcp.cname=Lt(16));var le=f.rtpParameters.msid;(le==""||!le)&&(f.rtpParameters.msid="- "+Lt(8)),(D=f.rtpParameters)!==null&&D!==void 0&&D.mid&&(f.rtpParameters.mid=Number(f.rtpParameters.mid))}),n}}]),o}(),Se=function(){function o(){ce()(this,o),C()(this,"_answer",void 0),C()(this,"sdp_offer",void 0),C()(this,"json_offer",void 0),C()(this,"json_snawer",void 0),C()(this,"local_ice_uflag",""),C()(this,"local_ice_pwd",""),C()(this,"transport_need",!0),this.json_snawer="",this.json_offer=null,this._answer=new be}return he()(o,[{key:"setLocalSdpOffer",value:function(u){var t=this;er(u.sdpOffer).then(function(e){t.json_offer=e,e!=null&&e.transport&&t._answer.setLocalSDPOffer({sdp_offer:K()({},e)})})}},{key:"getLocalSdpoffer",value:function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"pull",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"H264",e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"opus",r;return r=this.json_offer,Yt(r,t,e),this.local_ice_uflag&&this.local_ice_pwd&&(r.transport.iceParameters.usernameFragment=this.local_ice_uflag,r.transport.iceParameters.password=this.local_ice_pwd),r=$(r,u),r}},{key:"getLocalJsonOffer",value:function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.transport_need=u;var e,r={transportParams:{},mediaParams:[]};return u&&(r.transportParams=this.json_offer.transport,this.local_ice_uflag=this.json_offer.transport.iceParameters.usernameFragment,this.local_ice_pwd=this.json_offer.transport.iceParameters.password),this.json_offer.medias.forEach(function(a){var n=a.rtpParameters.mid;t.includes(n)&&r.mediaParams.push(a)}),e=JSON.stringify(r),e}},{key:"addRemoteSdpAnswer",value:function(u){this._answer.addRemoteSdpAnswer(u)}},{key:"createRemoteSdpAnswer",value:function(){var i=k()(h()().mark(function t(){var e,r,a,n=arguments;return h()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return e=n.length>0&&n[0]!==void 0?n[0]:"pull",c.next=3,this._answer.createRemoteSdpAnswer(this.transport_need);case 3:return r=c.sent,a=$(r,e),c.abrupt("return",a);case 6:case"end":return c.stop()}},t,this)}));function u(){return i.apply(this,arguments)}return u}()},{key:"removeRemoteJsonAnswer",value:function(){var i=k()(h()().mark(function t(e){return h()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:this._answer.removeRemoteJsonAnswer(e);case 1:case"end":return a.stop()}},t,this)}));function u(t){return i.apply(this,arguments)}return u}()}]),o}(),Re=null,nt=function(){return new Se},Pe=new Ze("QnTransport"),Et=function(){function o(i){ce()(this,o),C()(this,"qn_rtc",void 0),C()(this,"publishId",""),C()(this,"qn_sdp_negotiator",void 0),C()(this,"direction",void 0),C()(this,"_appData",void 0),C()(this,"_transportId",null),C()(this,"_consumerCreationInProgress",!0),this.qn_rtc=Vt(i.direction),this.qn_sdp_negotiator=nt(),this.direction=i.direction,this._appData=i.appData}return he()(o,[{key:"consumerCreationInProgress",get:function(){return this._consumerCreationInProgress},set:function(u){this.consumerCreationInProgress!==u&&(this._consumerCreationInProgress=u)}},{key:"transportId",get:function(){return this._transportId},set:function(u){this._transportId=u}},{key:"useTransceiver",value:function(u){Pe.info(this.direction+" : useTransceiver | mediaKind "+u);var t=null;return this.qn_rtc.useTransceiver({direction:this.direction,kind:u},function(e){t=e}),t}},{key:"createOffer",value:function(){var i=k()(h()().mark(function t(e){var r=this,a,n,s,c;return h()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return Pe.info(this.direction+" : \u521B\u5EFAOffers - start"),m.prev=1,m.next=4,this.qn_rtc.createOffers();case 4:return a=m.sent,e&&e.getTracks().map(function(f){return r.qn_rtc._pc.addTrack(f)}),Pe.info("createOffer() | offers",a),m.next=9,this.qn_sdp_negotiator.setLocalSdpOffer({sdpOffer:a.sdp});case 9:return Pe.info("createOffer() | setLocalSdpOffer"),n=this.direction==="sendonly"?"push":"pull",m.next=13,this.qn_sdp_negotiator.getLocalSdpoffer(n);case 13:return s=m.sent,c=new RTCSessionDescription({type:a.type,sdp:s}),m.next=17,this.qn_rtc._pc.setLocalDescription(c);case 17:return Pe.info("create offers success, offers: success"),m.abrupt("return",!0);case 21:return m.prev=21,m.t0=m.catch(1),Pe.error("create offers fail, reason: ",m.t0),m.abrupt("return",!1);case 25:case"end":return m.stop()}},t,this,[[1,21]])}));function u(t){return i.apply(this,arguments)}return u}()},{key:"getSdp",value:function(){var i=k()(h()().mark(function t(e){var r,a;return h()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(e.length){s.next=2;break}return s.abrupt("return",Pe.error("mids cannot be empty"));case 2:return s.prev=2,r=this.qn_sdp_negotiator.getLocalJsonOffer(!0,ke()(e)),a=JSON.parse(r),s.abrupt("return",a);case 8:return s.prev=8,s.t0=s.catch(2),Pe.error("\u8F6C\u6362\u79C1\u6709\u534F\u8BAE\u5931\u8D25, %o",s.t0),s.abrupt("return",!1);case 12:case"end":return s.stop()}},t,this,[[2,8]])}));function u(t){return i.apply(this,arguments)}return u}()},{key:"createRequestParams",value:function(u){if(!this.transportId){var t={method:"createTransport",params:{transportParams:JSON.stringify(u.transportParams)}};return t}}},{key:"handleAnswer",value:function(){var i=k()(h()().mark(function t(e){var r,a,n,s=arguments;return h()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return r=s.length>1&&s[1]!==void 0?s[1]:!0,this.qn_sdp_negotiator.addRemoteSdpAnswer(e),l.next=4,this.qn_sdp_negotiator.createRemoteSdpAnswer();case 4:return a=l.sent,l.next=7,this.qn_rtc.setRemoteAnswer(a);case 7:return n=l.sent,!this.transportId&&r&&this.qn_rtc._pc.getTransceivers().forEach(function(m){m.direction="inactive"}),l.abrupt("return",n);case 10:case"end":return l.stop()}},t,this)}));function u(t){return i.apply(this,arguments)}return u}()},{key:"createTransport",value:function(){var i=k()(h()().mark(function t(){var e,r;return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e=this.useTransceiver("audio"),n.next=3,this.createOffer();case 3:return n.next=5,this.getSdp([e.mid]);case 5:return r=n.sent,n.abrupt("return",this.createRequestParams(r));case 7:case"end":return n.stop()}},t,this)}));function u(){return i.apply(this,arguments)}return u}()},{key:"destoryChannel",value:function(){this.qn_rtc.closePc()}},{key:"produce",value:function(){var i=k()(h()().mark(function t(e){var r;return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return Pe.info("produce() | mids ",e),n.next=3,this.getSdp(ke()(e));case 3:return r=n.sent,n.abrupt("return",r);case 5:case"end":return n.stop()}},t,this)}));function u(t){return i.apply(this,arguments)}return u}()}]),o}(),rr=null,vt=function(i){return new Et(i)},He=new Ze("QnWebSocket"),De=function(o){return o.IDEL="IDEL",o.CONNECTING="CONNECTING",o.CONNECTED="CONNECTED",o.DISCONNECTED="DISCONNECTED",o.RECONNECTION="RECONNECTION",o.FAILED="FAILED",o.CLOSED="CLOSED",o}({}),sr=function(o){q()(u,o);var i=U()(u);function u(t){var e;return ce()(this,u),e=i.call(this),C()(P()(e),"MAX_RECONNECT_ATTEMPTS",5),C()(P()(e),"reconnectAttempts",0),C()(P()(e),"reconnectTimeout",1e3),C()(P()(e),"_reTryTimer",null),C()(P()(e),"_curUrlsId",0),C()(P()(e),"_wsConnectState",De.IDEL),C()(P()(e),"_urls",void 0),C()(P()(e),"ws",null),C()(P()(e),"_messageId",void 0),C()(P()(e),"_messageHandlers",new Set),C()(P()(e),"_heartTimer",null),C()(P()(e),"_heartMaxNum",3),e._messageId=0,e._urls=t,e.init(),e}return he()(u,[{key:"init",value:function(){var t=k()(h()().mark(function r(){var a=this;return h()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:He.debug("init() | "),He.debug("init() | _urls : ",this._urls),this.wsConnectState=De.CONNECTING,this.createdWebSocket(this._urls[this._curUrlsId]).catch(function(c){He.error("ws connected failed, reason:",c),a.wsConnectState=De.FAILED});case 4:case"end":return s.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"wsConnectState",get:function(){return this._wsConnectState},set:function(e){e!==this.wsConnectState&&(this._wsConnectState=e,He.info("ws connected state :",e),this.emit("ws-connected-state",e))}},{key:"addHandleMessages",value:function(e){this._messageHandlers.add(e)}},{key:"removeAllMessagesHandler",value:function(){this._messageHandlers=new Set}},{key:"handleMessages",value:function(e){var r=e.data,a=JSON.parse(r);this._messageHandlers.forEach(function(n){n&&n(a)})}},{key:"createdWebSocket",value:function(e){var r=this;return new Promise(function(a,n){if(r.ws&&(r.ws.onclose=null,r.ws.close()),!e){n("init websocket failed! Error: url is invalid");return}He.debug("websocket start connect, url: ".concat(e));try{r.ws=new WebSocket("".concat(e,"/openvidu"))}catch(s){n("init websocket failed! Error:"+s);return}r.ws.onmessage=r.handleMessages.bind(r),r.ws.onopen=function(){He.debug("websocket opened"),r.wsConnectState=De.CONNECTED,r.startHeartBeat(),r.reconnectAttempts=0,r._reTryTimer&&clearTimeout(r._reTryTimer),r._reTryTimer=null,a(!0)},r.ws.onclose=function(s){if(He.debug("websocket close ".concat(r._urls[r._curUrlsId],", code: ").concat(s.code,", reason: ").concat(s.reason)),console.log("this.wsConnectState ----> "+r.wsConnectState),r.wsConnectState===De.CONNECTED){He.error("no server"),r.wsConnectState=De.DISCONNECTED;return}if(r.wsConnectState===De.CLOSED){He.warning("ws connected is closed");return}r.wsConnectState===De.RECONNECTION&&r.reconnectedWS(),n(!1)},r.ws.onerror=function(s){He.error("websocket connect error: ",s),n("websocket connect error: "+s)}})}},{key:"sendMessage",value:function(e){e.jsonrpc="2.0",e.id||(e.id=this._messageId,this._messageId+=1);try{return this.ws&&this.ws.send(JSON.stringify(e)),e.id}catch(r){throw He.error("send websocket message error %o",r),"send websocket message error ".concat(r)}}},{key:"sendMessageBack",value:function(e){var r=this,a=this.sendMessage(e);return new Promise(function(n,s){var c=function l(m){if(m.id===a){r._messageHandlers.delete(l),m.result&&n(m.result),m.error?(He.error("[".concat(e.method,"]").concat(m.error.message)),s(m.error)):s();return}};r.addHandleMessages(c)})}},{key:"close",value:function(){this._curUrlsId=0,this.removeAllMessagesHandler(),this._heartTimer&&clearInterval(this._heartTimer),this._heartTimer=null,this.wsConnectState=De.CLOSED,this.ws&&(this.ws.onclose=null,this.ws.onopen=null,this.ws.onmessage=null,this.ws.close(),this.ws=null)}},{key:"startHeartBeat",value:function(){var e=this;this._heartTimer&&clearInterval(this._heartTimer),this._heartTimer=setInterval(function(){return e._sendHeartBeat()},1e4)}},{key:"_sendHeartBeat",value:function(){var t=k()(h()().mark(function r(){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.wsConnectState===De.CONNECTED){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,this.sendMessageBack({method:"ping",params:{}});case 4:case"end":return n.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"reconnectedWS",value:function(){var e=this;if(console.log("opensdk | QnWebSocket | reconnectedWS | this.reconnectAttempts : "+this.reconnectAttempts),this.reconnectAttempts<this.MAX_RECONNECT_ATTEMPTS){this.wsConnectState=De.RECONNECTION,this._heartTimer&&clearInterval(this._heartTimer),this._heartTimer=null;var r=this.reconnectTimeout*6;He.debug("backoffTime : "+r),this._reTryTimer=setTimeout(function(){e.createdWebSocket(e._urls[e._curUrlsId])},r),this.reconnectAttempts++}else this.wsConnectState=De.FAILED,this._reTryTimer&&clearTimeout(this._reTryTimer),this._reTryTimer=null,this.close()}}]),u}(st),et,ir=function(i){et&&et.close(),et=new sr(i)},it=new Ze("Consumer"),at=function(o){return o.START="START",o.SUNSCRIBE_ING="SUNSCRIBE_ING",o.SUNSCRIBE_SUCCED="SUNSCRIBE_SUCCED",o.SUNSCRIBE_FAILED="SUNSCRIBE_FAILED",o.CLOSED="CLOSED",o}({}),nr=function(o){q()(u,o);var i=U()(u);function u(t){var e;return ce()(this,u),e=i.call(this),C()(P()(e),"_uid",void 0),C()(P()(e),"_kind",void 0),C()(P()(e),"_streamType",void 0),C()(P()(e),"_state",void 0),C()(P()(e),"_track",null),C()(P()(e),"_rtpTransceiver",null),C()(P()(e),"_appData",void 0),C()(P()(e),"_closed",void 0),C()(P()(e),"_observer",void 0),C()(P()(e),"_publishId",void 0),C()(P()(e),"_subscribeId",void 0),C()(P()(e),"_streamMode",void 0),C()(P()(e),"_clientIdentifier",void 0),C()(P()(e),"_dom_audio",void 0),C()(P()(e),"_paused",!1),e._uid=t.uid,e._kind=t.kind,e._streamType=t.type,e._state=at.START,e._appData=t.appData,e._closed=!1,e._observer=new st,e._publishId=t.publishId,e._streamMode=t.streamMode,e._dom_audio=new Audio,e}return he()(u,[{key:"mid",get:function(){return this.rtpTransceiver.mid}},{key:"subscribeId",get:function(){return this._subscribeId},set:function(e){this._subscribeId=e}},{key:"streamType",get:function(){return this._streamType}},{key:"publishId",get:function(){return this._publishId}},{key:"streamMode",get:function(){return this._streamMode}},{key:"clientIdentifier",get:function(){return this._clientIdentifier},set:function(e){this._clientIdentifier=e}},{key:"state",get:function(){return this._state},set:function(e){e!==this.state&&(this._state=e,e===at.SUNSCRIBE_SUCCED&&(this._track=this._rtpTransceiver.receiver.track))}},{key:"uid",get:function(){return this._uid}},{key:"kind",get:function(){return this._kind}},{key:"stream",get:function(){if(!this._track){var e=new MediaStream;return e.addTrack(this._track),e}}},{key:"track",get:function(){return this._track}},{key:"consumerState",get:function(){return this._state},set:function(e){e!==this.consumerState&&(this.consumerState=e,at.CLOSED)}},{key:"observer",get:function(){return this._observer}},{key:"closed",get:function(){return this._closed},set:function(e){e!==this.closed&&(this.closed=e)}},{key:"rtpTransceiver",get:function(){return this._rtpTransceiver},set:function(e){this._rtpTransceiver=e}},{key:"close",value:function(){this.closed||(this.closed=!0,this._dom_audio=null,this.releaseTransceiver())}},{key:"play",value:function(){var e=this;if(this.closed){it.debug("play() | Consumer closed");return}if(this.kind!=="audio"){it.debug("play() | Video type not supported");return}this._dom_audio&&(this._dom_audio.srcObject=this.stream),this._dom_audio&&(this._dom_audio.oncanplay=function(){e._dom_audio&&e._dom_audio.play()})}},{key:"pause",value:function(){if(it.info("pause()"),this.closed){it.debug("pause() | Consumer closed");return}if(this._paused){it.debug("Paused playback, please do not repeat the operation");return}this._paused=!0,this._dom_audio.pause()}},{key:"resume",value:function(){if(it.info("resume()"),this.closed){it.debug("resume() | Consumer closed");return}this._paused&&(this._paused=!1,this._dom_audio.play())}},{key:"setSinkId",value:function(e){var r;(r=this._dom_audio)===null||r===void 0||r.setSinkId(e)}},{key:"handleTrack",value:function(){this._track.addEventListener("ended",this.onTrackEnded)}},{key:"onTrackEnded",value:function(){this._observer.emit("trackended")}},{key:"releaseTransceiver",value:function(){if(!this._rtpTransceiver)return it.error("rtpTransceiver cannot be empty");this._rtpTransceiver.direction="inactive"}}]),u}(st),Cr=function(i){return new nr(i)},Xe=new Ze("Producer"),or=function(){function o(i){ce()(this,o),C()(this,"_uid",void 0),C()(this,"_kind",void 0),C()(this,"_publishId",void 0),C()(this,"_track",void 0),C()(this,"_rtpTransceiver",void 0),C()(this,"_rtpSender",void 0),C()(this,"_paused",void 0),C()(this,"_closed",void 0),C()(this,"_producerId",void 0),C()(this,"observer",void 0),this._uid=i.uid,this._kind=i.kind,this._publishId=i.publishId,this._track=i.track,this._rtpTransceiver=i.rtpTransceiver,this._rtpSender=i.rtpTransceiver.sender,this._paused=(i==null?void 0:i.track.enabled)||!1,this._closed=!1,this._producerId=i.producerId,this.observer=new st,this.handleTrack()}return he()(o,[{key:"kind",get:function(){return this._kind}},{key:"track",get:function(){return this._track},set:function(u){this._track=u}},{key:"closed",get:function(){return this._closed}},{key:"stream",get:function(){var u=new MediaStream;return this.track&&u.addTrack(this.track),u}},{key:"publishId",get:function(){return this._publishId},set:function(u){this._publishId=u}},{key:"rtpTransceiver",get:function(){return this._rtpTransceiver}},{key:"paused",get:function(){return this._paused}},{key:"pause",value:function(){if(Xe.info("pause()"),this._closed){Xe.error("pause() | Producer closed");return}this._paused=!1,this._track&&(this._track.enabled=!1)}},{key:"resume",value:function(){if(Xe.info("resume()"),this._closed){Xe.error("resume() | Producer closed");return}this._paused=!0,this._track&&(this._track.enabled=!0)}},{key:"enabled",value:function(){try{return this.closed?Xe.debug("track closed"):(this._paused=!this._paused,this._rtpSender.track.enabled=this._paused,!0)}catch(u){return Xe.error("set track enabled failed, "+u),!1}}},{key:"transportClosed",value:function(){this._closed||(Xe.debug("transport closed"),this._closed=!0,this.destroyTrack())}},{key:"close",value:function(){if(this.closed)return Xe.debug("track closed");this._closed=!0,this.observer.removeAllListeners()}},{key:"replaceTrack",value:function(){var i=k()(h()().mark(function t(e){return h()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this._closed&&e)try{this._track.stop()}catch(n){Xe.error("stop track error, %o",n)}if(e!==this._track){a.next=4;break}return Xe.debug("replaceTrack() | same track, ignored"),a.abrupt("return");case 4:return a.prev=4,a.next=7,this.destroyTrack();case 7:return this._track=e,console.log("producer | \u5207\u6362\u8BBE\u5907 | paused : "+this.paused),this._track.enabled=this.paused,this.handleTrack(),this._rtpSender.replaceTrack(this._track),a.abrupt("return",Promise.resolve(!0));case 15:return a.prev=15,a.t0=a.catch(4),Xe.error("replace track error, %o",a.t0),a.abrupt("return",Promise.resolve(!1));case 19:case"end":return a.stop()}},t,this,[[4,15]])}));function u(t){return i.apply(this,arguments)}return u}()},{key:"destroyTrack",value:function(){var i=k()(h()().mark(function t(){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this._track.stop();case 2:this._track.onended=null;case 3:case"end":return r.stop()}},t,this)}));function u(){return i.apply(this,arguments)}return u}()},{key:"handleTrack",value:function(){var u=this;this._track&&(this._track.onended=function(){Xe.debug('track "ended" event'),u.observer.emit("ended",u._publishId)})}},{key:"getStats",value:function(){return this._rtpTransceiver.sender.getStats()}}]),o}(),Ir=null,me=new Ze("QnClient"),ur=he()(function o(i){var u=this;ce()(this,o),C()(this,"consumerOptions",void 0),C()(this,"promise",void 0),C()(this,"resolve",void 0),C()(this,"reject",void 0),this.consumerOptions=i,this.promise=new Promise(function(t,e){u.resolve=t,u.reject=e})}),cr=["setAudioStatus","setVideoStatus","setAudioSpeakerStatus","raiseHand","putDownHand","setRollCallNotify","endRollCallNotify","replaceRollCallNotify","participantEvicted","pollingToNotify","stopPollingNotify","setPartSelfDismissMuteNotify","setPartOperSpeaker","participantJoined","partOrderOrRoleChangeNotify","participantLeft","closeRoomNotify","switchVoiceModeNotify","setPushStreamStatus","participantPublished","participantUnpublished","setMuteAllNotify","applyShareNotify","endShareNotify","startConferenceRecord"],dr=function(o){q()(u,o);var i=U()(u);function u(t){var e,r=t.account,a=t.token,n=t.nickName,s=t.urls,c=t.roomId,l=t.role,m=t.conferenceMode;return ce()(this,u),e=i.call(this),C()(P()(e),"sendTransport",null),C()(P()(e),"recvTransport",null),C()(P()(e),"shareTransport",null),C()(P()(e),"_account",void 0),C()(P()(e),"_token",void 0),C()(P()(e),"_nickName",void 0),C()(P()(e),"_role",void 0),C()(P()(e),"_roomId",void 0),C()(P()(e),"_urls",[]),C()(P()(e),"_pendingConsumerTasks",[]),C()(P()(e),"_consumerCreationInProgress",!0),C()(P()(e),"_conferenceMode",void 0),C()(P()(e),"_consumers",new Map),C()(P()(e),"_producers",new Map),me.debug("constructor(){} | account: "+r+",token: "+a+",nickName: "+n+",urls : "+s+",roomId : "+c+",role : "+l),e._account=r,e._token=a,e._nickName=n,e._urls=s,e._roomId=c,e._role=l,e._conferenceMode=m||"SFU",e.initClient(),e}return he()(u,[{key:"initClient",value:function(){var t=k()(h()().mark(function r(){var a=this;return h()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:ir(this._urls),et.on("ws-connected-state",function(c){return a.handleWsConnectedState(c)});case 2:case"end":return s.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"handleNotifyMessage",value:function(e){var r=e.method,a=e.params;if(cr.includes(r))switch(r){case"setAudioStatus":return this.emit("switch_device",this._roomId,K()({type:"audio"},a));case"setVideoStatus":return this.emit("switch_device",this._roomId,K()({type:"video"},a));case"participantJoined":return this.emit("participant_change",this._roomId,{type:"join",user:a});case"participantLeft":return this.emit("participant_change",this._roomId,K()({type:"leave"},a));case"participantEvicted":return this.emit("participant_change",this._roomId,K()({type:"evicted"},a));case"participantPublished":return this.emit("participant_stream_change",this._roomId,K()({type:"add"},a));case"participantUnpublished":return this.emit("participant_stream_change",this._roomId,K()({type:"delete"},a));case"pollingToNotify":case"stopPollingNotify":case"raiseHand":case"putDownHand":case"setRollCallNotify":case"endRollCallNotify":case"replaceRollCallNotify":case"closeRoomNotify":case"setMuteAllNotify":case"applyShareNotify":case"endShareNotify":case"setPartSelfDismissMuteNotify":case"partOrderOrRoleChangeNotify":case"setPushStreamStatus":case"discardVideoStreamStatusChangeNotify":case"userBreakLine":return this.emit("room_notification",r,a)}}},{key:"handleWsConnectedState",value:function(e){var r=this;switch(e){case De.CONNECTED:me.info("ws handleWsConnectedState() | "+e),et.addHandleMessages(function(a){return r.handleNotifyMessage(a)}),this._accessIn(),this.emit("network_state",e);return;case De.DISCONNECTED:me.info("ws handleWsConnectedState() | "+e),this.emit("network_state",e),this.releaseMediaResources();return;case De.RECONNECTION:me.info("ws handleWsConnectedState() | "+e),this.emit("network_state",e);return;case De.FAILED:me.info("ws handleWsConnectedState() | "+e),this.emit("network_state",e);return;case De.CLOSED:me.info("ws handleWsConnectedState() | "+e),this.emit("network_state",e);return;default:me.info("ws handleWsConnectedState() | "+e);return}}},{key:"networkReconnect",value:function(){et.reconnectedWS()}},{key:"sendMessageBack",value:function(){var t=k()(h()().mark(function r(a){var n;return h()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,et.sendMessageBack(a);case 2:return n=c.sent,c.abrupt("return",n);case 4:case"end":return c.stop()}},r)}));function e(r){return t.apply(this,arguments)}return e}()},{key:"_accessIn",value:function(){var t=k()(h()().mark(function r(){var a,n,s=arguments;return h()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return a=s.length>0&&s[0]!==void 0?s[0]:!1,n=ft(),n||(n=Rt(),At(n)),l.next=5,this.sendMessageBack({method:"accessIn",params:{account:this._account,token:this._token,udid:n,userType:"tourist",nickName:this._nickName,forceLogin:a,accessType:"web",mac:"04:D9:F5:03:C6:"+(Math.random()*100).toFixed(0),type:"WEB",deviceVersion:"v1.4.1-",clientTimestamp:new Date().valueOf(),deviceModel:"web"}});case 5:case"end":return l.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_accessOut",value:function(){var t=k()(h()().mark(function r(){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.sendMessageBack({method:"accessOut",params:{}});case 2:et==null||et.close(),this.removeAllListeners();case 4:case"end":return n.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"loginRoom",value:function(e){var r=e.micStatus,a=e.videoStatus,n=e.moderatorPassword,s=e.password,c=e.isReconnected,l=e.roomId,m=e.nickname,f=e.account;return this.sendMessageBack({method:"joinRoom",params:{metadata:JSON.stringify({account:f}),session:l,dataChannels:!1,secret:"",ruid:"",platform:"web",role:this._role||"SUBSCRIBER",streamType:"MAJOR",joinType:"active",conferenceMode:this._conferenceMode,isReconnected:c||!1,micStatus:r,videoStatus:a,moderatorPassword:n,password:s,roomIdType:"unknown",roomId:l,nickname:m}})}},{key:"releaseMediaResources",value:function(){this._producers=new Map([]),this._consumers=new Map([]),this.sendTransport&&this.sendTransport.destoryChannel(),this.shareTransport&&this.shareTransport.destoryChannel(),this.recvTransport&&this.recvTransport.destoryChannel(),this.sendTransport&&(this.sendTransport=null),this.shareTransport&&(this.shareTransport=null),this.recvTransport&&(this.recvTransport=null)}},{key:"leaveRoom",value:function(){var t=k()(h()().mark(function r(){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.sendMessageBack({method:"leaveRoom",params:{roomId:this._roomId,sourceId:this._account,streamType:"MAJOR"}});case 2:case"end":return n.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"createRecvTransport",value:function(){var t=k()(h()().mark(function r(){var a,n;return h()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.recvTransport||(this.recvTransport=vt({direction:"recvonly"})),c.next=3,this.recvTransport.createTransport();case 3:return a=c.sent,me.debug("createRecvTransport() | channelParams",a),c.next=7,this.sendMessageBack(a);case 7:return n=c.sent,c.next=10,this.recvTransport.handleAnswer(JSON.parse(n.transportResult));case 10:return this.recvTransport.transportId=n.transportId,this._consumerCreationInProgress=!1,c.abrupt("return",!0);case 13:case"end":return c.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"pullStream",value:function(){var t=k()(h()().mark(function r(a){var n;return h()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(n=new ur(a),me.debug("pullStream() | consumer",n),this._pendingConsumerTasks.push(n),me.debug("pullStream() | this._consumerCreationInProgress",this._consumerCreationInProgress),this._consumerCreationInProgress!==!1){c.next=7;break}return c.next=7,this.createPendingConsumer();case 7:return c.abrupt("return",n.promise);case 8:case"end":return c.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e}()},{key:"createClientIdentifier",value:function(e,r,a){var n;return n="".concat(e,"_").concat(r,"_").concat(a),n}},{key:"removeDuplicate",value:function(e){if(!e.length)return[];var r={},a=e.reduce(function(n,s){var c=s.consumerOptions,l=c.uid,m=c.kind,f=c.type;return r["".concat(l,"_").concat(m,"_").concat(f)]||(r["".concat(l,"_").concat(m,"_").concat(f)]=n.push(s)),n},[]);return a}},{key:"createPendingConsumer",value:function(){var t=k()(h()().mark(function r(){var a=this,n,s,c,l,m,f,b,D,R,L;return h()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(this.recvTransport){F.next=2;break}return F.abrupt("return");case 2:if(this._pendingConsumerTasks.length!==0){F.next=5;break}return me.debug("createPendingConsumers() | there is no Consumer to be created"),F.abrupt("return");case 5:return this._consumerCreationInProgress=!0,n=[],this._pendingConsumerTasks.length>5?n=this.removeDuplicate(ke()(this._pendingConsumerTasks.splice(0,5))):(n=this.removeDuplicate(ke()(this._pendingConsumerTasks)),this._pendingConsumerTasks=[]),s=function(){n.forEach(function(A){var le=A.consumerOptions,je=le.uid,pe=le.kind,ye=le.type;if(!a._consumers.has("".concat(je,"_").concat(pe,"_").concat(ye))){var Be=a.recvTransport&&a.recvTransport.useTransceiver(pe),Ge=new nr(A.consumerOptions);Ge.rtpTransceiver=Be,Ge.clientIdentifier=a.createClientIdentifier(je,pe,ye),Ge.state=at.SUNSCRIBE_ING,a._consumers.set("".concat(je,"_").concat(pe,"_").concat(ye),Ge)}})},s(),F.next=12,this.recvTransport.createOffer();case 12:return c=function(){var A=[];return new Promise(function(le,je){n.forEach(function(pe){var ye=pe.consumerOptions,Be=ye.uid,Ge=ye.kind,Oe=ye.type,G=a._consumers.get("".concat(Be,"_").concat(Ge,"_").concat(Oe));if((G==null?void 0:G.state)===at.SUNSCRIBE_ING){var Ue=G&&G.mid;A.push(Ue)}}),A.length===0&&(me.debug("mids cannot be empty ... ..."),a._consumerCreationInProgress=!1,je(A)),le(A)})},F.next=15,c();case 15:return l=F.sent,F.next=18,this.recvTransport.getSdp(ke()(l));case 18:return m=F.sent,f=function(){if(a.recvTransport){var A=[];return new Promise(function(le,je){l.forEach(function(pe){var ye={transportParams:m.transportParams,mediaParams:[]},Be=m.mediaParams.find(function(G){return G.rtpParameters.mid===pe});ye.mediaParams.push(Be);var Ge=a._consumers.values(),Oe=ke()(Ge).find(function(G){return G.mid===pe&&G.state===at.SUNSCRIBE_ING})||void 0;Oe&&A.push({transportId:a.recvTransport&&a.recvTransport.transportId,sdpOffer:JSON.stringify(ye),senderUuid:Oe&&Oe.uid,streamType:Oe&&Oe.streamType,publishId:Oe&&Oe.publishId,streamMode:Oe&&Oe.streamMode,mediaType:Oe&&Oe.kind,clientIdentifier:Oe&&Oe.clientIdentifier})}),A.length===0&&le(!1),le({method:"pullStream",params:{syncMode:"sync",publishs:A}})})}},F.next=22,f();case 22:if(b=F.sent,typeof b!="boolean"){F.next=27;break}return this._consumerCreationInProgress=!1,me.debug("pullRequestParams failed"),F.abrupt("return");case 27:return F.next=29,this.sendMessageBack(b);case 29:if(D=F.sent,R=this.handlePullAnswer(D),L=this.recvTransport.handleAnswer({mediaParams:R},!1),L){F.next=34;break}return F.abrupt("return",!1);case 34:this.updateConsumer(n,D),this._pendingConsumerTasks.length>0?this.createPendingConsumer():this._consumerCreationInProgress=!1;case 36:case"end":return F.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"handlePullAnswer",value:function(e){var r=[];return e.forEach(function(a){if(!(a.errorCode>0)){var n=JSON.parse(a.sdpAnswer);r.push.apply(r,ke()(n.mediaParams))}}),r}},{key:"updateConsumer",value:function(e,r){var a=this;r.forEach(function(n){if(!a._consumers.has(n.clientIdentifier))return me.debug("consumer be unSubscriber");var s=a._consumers.get(n.clientIdentifier);if(s&&s.state!==at.SUNSCRIBE_ING)return s.releaseTransceiver(),me.debug("Unsubscribe and resubscribe");var c=e.filter(function(l){var m=l.consumerOptions,f=m.uid,b=m.kind,D=m.type;if("".concat(f,"_").concat(b,"_").concat(D)===n.clientIdentifier)return l})[0];n.errorCode>0?(s&&s.releaseTransceiver(),s&&(s.state=at.SUNSCRIBE_FAILED),me.error("[pullstream]: ".concat(n.clientIdentifier," webrtc negotiation failed")),c&&c.reject(new Error("\u62C9\u6D41\u5931\u8D25"))):(s&&(s.state=at.SUNSCRIBE_SUCCED),s&&(s.subscribeId=n.subscribeId),me.debug("[pullstream]: ".concat(n.clientIdentifier," \u62C9\u6D41\u6210\u529F"))),a._consumers.set(n.clientIdentifier,s),c&&c.resolve(s)})}},{key:"stopPullStream",value:function(){var t=k()(h()().mark(function r(a){var n,s,c,l,m,f,b,D,R;return h()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(n=a.account,s=a.type,c=a.kind,l=n+"_"+c+"_"+s,this._consumers.has(l)){O.next=4;break}return O.abrupt("return");case 4:return m=this._consumers.get(l),f=m,b=f.clientIdentifier,D=f.subscribeId,R=f.streamMode,m.rtpTransceiver.direction="inactive",this._consumers.delete(l),O.abrupt("return",this.sendMessageBack({method:"batchNoPullStream",params:{syncMode:"sync",noPulls:[{subscribeId:D,streamType:s,streamMode:R,clientIdentifier:b,mediaTypes:[c],senderUuid:n}]}}));case 9:case"end":return O.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e}()},{key:"pushStream",value:function(){var t=k()(h()().mark(function r(a){var n=this,s,c,l,m,f,b,D,R,L,O,F;return h()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=a.type,c=a.stream,l=a.mode,m=a.videoStatus,f=a.micStatus,this.sendTransport||(this.sendTransport=vt({direction:"sendonly"})),b=this.sendTransport.useTransceiver("video"),D=this.sendTransport.useTransceiver("audio"),A.next=6,this.sendTransport.createOffer(c);case 6:return R=this.sendTransport.qn_rtc._pc.getTransceivers().map(function(le){return le.mid}),A.next=9,this.sendTransport.produce(ke()(R));case 9:return L=A.sent,A.next=12,this.sendMessageBack({method:"publishVideo",params:{streamType:s,hasVideo:!0,hasAudio:!0,sdpOffer:JSON.stringify(L),audioOnly:!1,doLoopback:!1,handStatus:!1,videoStatus:m,micStatus:f}});case 12:return O=A.sent,A.next=15,this.sendTransport.handleAnswer(JSON.parse(O.sdpAnswer));case 15:F=A.sent,c.getTracks().map(function(le){var je=le.kind==="video"?b:D,pe="".concat(n._account,"_").concat(le.kind,"_").concat(s),ye=new or({producerId:pe,kind:"video",type:s,streamMode:l,track:le,rtpTransceiver:je});ye.track=le,ye.observer.on("ended",function(Be){n.emit("push_stream_change",{id:Be,state:"ended"})}),n._producers.set("".concat(pe),ye)}),me.info("pushStream() | push Stream result ",F),this.sendTransport.publishId=O.publishId;case 19:case"end":return A.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e}()},{key:"stopPushStream",value:function(){var t=k()(h()().mark(function r(){var a=this,n;return h()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.sendTransport){c.next=2;break}return c.abrupt("return");case 2:return c.next=4,this.sendMessageBack({method:"unpublishVideo",params:{publishId:this.sendTransport.publishId}});case 4:return n=this._producers.values(),ke()(n).map(function(l){l.close(),a._producers.delete("".concat(a._account,"_").concat(l.kind,"_MAJOR"))}),c.abrupt("return",!0);case 7:case"end":return c.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"startSharing",value:function(){var t=k()(h()().mark(function r(a,n){var s,c,l=this,m,f,b,D,R,L,O,F;return h()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return this.shareTransport||(this.shareTransport=vt({direction:"sendonly"})),m=null,n.micStatus==="on"&&(m=this.shareTransport.useTransceiver("audio")),f=this.shareTransport.useTransceiver("video"),A.next=6,this.shareTransport.createOffer(a);case 6:return b=new Set([]),this.shareTransport.qn_rtc._pc.getTransceivers().forEach(function(le){le&&b.add(le.mid)}),me.info("startSharing() | mids",b),A.next=11,this.shareTransport.produce(ke()(b));case 11:return D=A.sent,R=n.videoStatus,L=n.micStatus,A.next=15,this.sendMessageBack({method:"publishVideo",params:{streamType:"SHARING",hasVideo:!0,hasAudio:!0,sdpOffer:JSON.stringify(D),audioOnly:!1,doLoopback:!1,handStatus:!1,videoStatus:R,micStatus:L}});case 15:if(O=A.sent,A.t0=m,!A.t0){A.next=20;break}return A.next=20,m.sender.replaceTrack((s=a.getAudioTracks())===null||s===void 0?void 0:s[0]).then(function(){return me.info("replaceTrack() | audio success")});case 20:if(A.t1=f,!A.t1){A.next=24;break}return A.next=24,f.sender.replaceTrack((c=a.getVideoTracks())===null||c===void 0?void 0:c[0]).then(function(){return me.info("replaceTrack() | video success")});case 24:return a.getVideoTracks()[0].onended=function(){l.endShare()},A.next=27,this.shareTransport.handleAnswer(JSON.parse(O.sdpAnswer),!1);case 27:return F=new MediaStream,F=a,A.abrupt("return",F);case 30:case"end":return A.stop()}},r,this)}));function e(r,a){return t.apply(this,arguments)}return e}()},{key:"reSharing",value:function(e){var r=this,a=this.shareTransport&&this.shareTransport.qn_rtc._pc.getSenders();a&&a.forEach(function(n){if(n&&n.track!=null){var s;n.track.stop(),n.track.onended=null;var c=(s=e.getTracks().filter(function(l){return l!==null&&l.kind===(n.track&&n.track.kind)}))===null||s===void 0?void 0:s[0];c.kind==="video"&&(c.onended=function(){me.info("reSharing() | onended"),r.endShare()}),c&&n.replaceTrack(c)}})}},{key:"applyShare",value:function(){var t=k()(h()().mark(function r(){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.sendMessageBack({method:"applyShare",params:{roomId:this._roomId,targetId:this._account,originator:ft(),shareType:1}}));case 1:case"end":return n.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"endShare",value:function(){var t=k()(h()().mark(function r(){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.sendMessageBack({method:"endShare",params:{roomId:this._roomId,targetId:this._account,originator:ft(),shareType:1}});case 2:case"end":return n.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"endSharing",value:function(){if(this.shareTransport){var e=this.shareTransport.qn_rtc._pc.getSenders();e.forEach(function(r){r&&r.track&&(r.track.stop(),r.track.onended=null)}),this.shareTransport.qn_rtc.closePc(),this.shareTransport=null}}},{key:"raiseHand",value:function(){return this.sendMessageBack({method:"raiseHand",params:{roomId:this._roomId,sourceId:this._account}})}},{key:"putDownHand",value:function(){return this.sendMessageBack({method:"putDownHand",params:{roomId:this._roomId,sourceId:this._account,targetId:this._account}})}},{key:"endRollCall",value:function(){return this.sendMessageBack({method:"endRollCall",params:{roomId:this._roomId,targetId:this._account,originator:this._account}})}},{key:"getParticipantsList",value:function(e){var r=e.searchType,a=e.targetIds;return this.sendMessageBack({method:"getParticipants",params:{roomId:this._roomId,searchType:r,targetIds:a}}).then(function(n){return me.debug("getParticipantsList() | result",n),n.participantList}).catch(function(n){me.error(" get "+r+"list failed, errorMessage :",n)})}},{key:"setAudioStatus",value:function(e){return me.debug("\u6253\u5F00\u9EA6\u514B\u98CE\u7F51\u7EDC\u8BF7\u6C42"),this.sendMessageBack({method:"setAudioStatus",params:{roomId:this._roomId,source:this._account,targets:[this._account],status:e}})}},{key:"setVideoStatus",value:function(e){return this.sendMessageBack({method:"setVideoStatus",params:{roomId:this._roomId,source:this._account,targets:[this._account],status:e}})}},{key:"muteMic",value:function(){var t=k()(h()().mark(function r(a){return h()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.setAudioStatus("off");case 2:return s.abrupt("return",this.switchDevice(a,"audio","off"));case 3:case"end":return s.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e}()},{key:"unmuteMic",value:function(){var t=k()(h()().mark(function r(a){return h()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.setAudioStatus("on");case 2:return s.abrupt("return",this.switchDevice(a,"audio","on"));case 3:case"end":return s.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e}()},{key:"muteCam",value:function(){var t=k()(h()().mark(function r(a){return h()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.setVideoStatus("off");case 2:return s.abrupt("return",this.switchDevice(a,"video","off"));case 3:case"end":return s.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e}()},{key:"unmuteCam",value:function(){var t=k()(h()().mark(function r(a){return h()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.setVideoStatus("on");case 2:return s.abrupt("return",this.switchDevice(a,"video","on"));case 3:case"end":return s.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e}()},{key:"switchDevice",value:function(){var t=k()(h()().mark(function r(a,n,s){var c;return h()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(m.prev=0,me.debug("switchDevice() | switch device kind : "+n+", status : "+s),me.debug("\u662F\u5426\u5B58\u5728 producerID : "+this._producers.has(a)),!this._producers.has(a)){m.next=8;break}return c=this._producers.get(a),n==="audio"&&(s==="on"?c&&c.resume():c&&c.pause()),n==="video"&&(s==="on"?c&&c.resume():c&&c.pause()),m.abrupt("return",!0);case 8:return m.abrupt("return",!1);case 11:return m.prev=11,m.t0=m.catch(0),m.abrupt("return",!1);case 14:case"end":return m.stop()}},r,this,[[0,11]])}));function e(r,a,n){return t.apply(this,arguments)}return e}()},{key:"replaceTrack",value:function(e,r){if(this._producers.has(e)){var a=this._producers.get(e);return console.log("QnClient | \u5207\u6362\u8BBE\u5907 | track ---> ",r),a&&a.replaceTrack(r)}}},{key:"changeAudioOutputDevice",value:function(e){this._consumers.forEach(function(r){return r.kind==="audio"&&r.setSinkId(e)})}},{key:"getProducer",value:function(e){return this._producers.has(e)?this._producers.get(e):!1}}]),u}(st),lr=dr,_t=new Ze("GenerateMediaStream"),pr=function(){var o=k()(h()().mark(function i(u){var t;return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(_t.debug("createCustomAudioTrack()"),!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)){r.next=6;break}return r.next=4,navigator.mediaDevices.getUserMedia({audio:u});case 4:return t=r.sent,r.abrupt("return",Promise.resolve(t.getAudioTracks()[0]));case 6:return r.abrupt("return",Promise.reject({message:"The current browser does not support this feature",name:"NotSupportedError"}));case 7:case"end":return r.stop()}},i)}));return function(u){return o.apply(this,arguments)}}(),hr=function(){var o=k()(h()().mark(function i(u){var t;return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(_t.debug("createCustomVideoTrack() | constraints ",u),!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)){r.next=6;break}return r.next=4,navigator.mediaDevices.getUserMedia({video:u});case 4:return t=r.sent,r.abrupt("return",Promise.resolve(t.getVideoTracks()[0]));case 6:return r.abrupt("return",Promise.reject({message:"The current browser does not support this feature",name:"NotSupportedError"}));case 7:case"end":return r.stop()}},i)}));return function(u){return o.apply(this,arguments)}}(),mr=function(){var o=k()(h()().mark(function i(u){return h()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return _t.debug("createMediaStream()"),_t.debug("createMediaStream() | constraints : ",u),e.abrupt("return",new Promise(function(r,a){navigator.mediaDevices.getUserMedia(u).then(function(n){r(n)}).catch(function(n){return _t.error("[createMediaStream] [ERROR]: "+n),a({message:"The current browser does not support this feature",name:"NotSupportedError"})})}));case 3:case"end":return e.stop()}},i)}));return function(u){return o.apply(this,arguments)}}(),Tr=null,Er=g(30767),Pr=new Jt,ht=g(56324),N=g(84424),ot=g(80008),Ae=g(79095),Bt=g(23089),Pt=g(86949),gt=g(82188),Le=g(58301),fr=function(o){q()(u,o);var i=U()(u);function u(t){var e;return ce()(this,u),e=i.call(this),C()(P()(e),"qnClient",null),C()(P()(e),"network_state",ht.Tb.IDEL),C()(P()(e),"userList",void 0),C()(P()(e),"_roomState","idel"),C()(P()(e),"_pullTransport",!1),e.run(t),e.userList={},e}return he()(u,[{key:"run",value:function(e){var r=this;this.qnClient=new lr(K()({},e)),this.qnClient.on("network_state",function(a,n){switch(r.network_state=a,(0,N.BZ)(a),a){case ht.Tb.DISCONNECTED:N.Er.consumersStream={};return;case ht.Tb.RECONNECTION:console.log("qnbase | run | network_state : "+a);return;case ht.Tb.FAILED:console.log("qnbase | run | network_state : "+a),(0,Bt.cU)({title:"\u63D0\u793A",content:n===ht.Tb.RECONNECTION?"\u4F1A\u8BAE\u91CD\u8FDE\u5931\u8D25\uFF0C\u5DF2\u81EA\u52A8\u9000\u51FA\u4F1A\u8BAE":"\u7F51\u7EDC\u8FDE\u63A5\u5931\u8D25,\u8BF7\u5237\u65B0\u540E\u91CD\u8BD5",okText:"\u786E\u5B9A",onOk:function(){return r.leaveRoom()}});return}})}},{key:"joinRoom",value:function(e){var r=this,a=e.micStatus,n=e.videoStatus,s=e.moderatorPassword,c=e.password,l=e.isReconnected,m=e.roomId,f=e.nickname,b=e.account,D;return new Promise(function(){var R=k()(h()().mark(function L(O,F){var ie,A,le,je,pe,ye,Be,Ge;return h()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.prev=0,D=setTimeout(function(){Le.ZP.warning("\u52A0\u5165\u4F1A\u8BAE\u5931\u8D25,\u8BF7\u91CD\u8BD5\u8BD5"),F(!1)},5e3),G.next=4,(ie=r.qnClient)===null||ie===void 0?void 0:ie.loginRoom({roomId:m,nickname:f,account:b,micStatus:a,videoStatus:n,moderatorPassword:s,password:c,isReconnected:l});case 4:if(A=G.sent,A.errorCode){G.next=29;break}return r._roomState="connected",D&&clearTimeout(D),D=null,pe=void 0,((le=A.roomInfo)===null||le===void 0?void 0:le.lock)==="on"&&O(A),(0,N.aP)(K()({},A.roomInfo)),A.roomInfo.isVoiceMode&&(0,N.fX)(A.roomInfo.isVoiceMode),A.roomInfo.speakerUuid&&(pe="".concat(A.roomInfo.speakerUuid,"_MAJOR")),A.roomInfo.sharingUuid&&(pe="".concat(A.roomInfo.sharingUuid,"_SHARING"),pe&&(0,N.hw)(pe),(0,N.OB)(A.roomInfo.shareType)),pe&&(0,N.pn)(pe),G.next=18,r.qnClient&&r.qnClient.createRecvTransport();case 18:return r._pullTransport=G.sent,G.next=21,(je=r.qnClient)===null||je===void 0?void 0:je.getParticipantsList({searchType:"exact",targetIds:[E.EA.account]});case 21:ye=G.sent,Be=We()(ye,1),Ge=Be[0],(0,E.Il)(K()(K()({},Ge),{},{streamType:"MAJOR"})),r.updateParticipantsList(),r.getPublisherParticipant(),r.listenQnClientEvent(),O(A);case 29:F(!1),G.next=37;break;case 32:G.prev=32,G.t0=G.catch(0),D&&clearTimeout(D),D=null,F(G.t0);case 37:case"end":return G.stop()}},L,null,[[0,32]])}));return function(L,O){return R.apply(this,arguments)}}())}},{key:"switchAudioInputState",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(E.EA.userInfo&&E.EA.userInfo.micStatus==="off"){var r,a;if(!e&&((r=N.Er.roomInfo)===null||r===void 0?void 0:r.allowPartDismissMute)==="off")return Le.ZP.error("\u4E3B\u6301\u4EBA\u7981\u6B62\u7528\u6237\u81EA\u6211\u89E3\u9664\u9759\u97F3");this.qnClient&&((a=this.qnClient)===null||a===void 0||a.unmuteMic("".concat(E.EA.account,"_audio_MAJOR"))),Le.ZP.success("\u9EA6\u514B\u98CE\u5DF2\u5F00\u542F")}else{var n,s;if(this.qnClient&&((n=this.qnClient)===null||n===void 0||n.muteMic("".concat(E.EA.account,"_audio_MAJOR"))),Le.ZP.success("\u9EA6\u514B\u98CE\u5DF2\u5173\u95ED"),((s=E.EA.userInfo)===null||s===void 0?void 0:s.handStatus)==="speaker")return Le.ZP.warning("\u60A8\u5DF2\u9759\u97F3\uFF0C\u8BF7\u6253\u5F00\u9EA6\u514B\u98CE\u540E\u4EA4\u6D41")}}},{key:"switchVideoInputState",value:function(){if(E.EA!==null&&E.EA!==void 0&&E.EA.userInfo)if(E.EA.userInfo.videoStatus==="off"){var e;this.qnClient&&((e=this.qnClient)===null||e===void 0||e.unmuteCam("".concat(E.EA.account,"_video_MAJOR"))),Le.ZP.success("\u6444\u50CF\u5934\u5DF2\u5F00\u542F")}else{var r;this.qnClient&&((r=this.qnClient)===null||r===void 0||r.muteCam("".concat(E.EA.account,"_video_MAJOR"))),Le.ZP.success("\u6444\u50CF\u5934\u5DF2\u5173\u95ED")}}},{key:"publishStream",value:function(){var t=k()(h()().mark(function r(){var a,n,s,c,l;return h()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(console.log("\u5F00\u59CB\u62C9\u6D41 meeting?.consumersStream: ",N.Er===null||N.Er===void 0?void 0:N.Er.consumersStream),f.prev=1,this.qnClient){f.next=4;break}return f.abrupt("return");case 4:return s=E.EA.cameraStatus,c=E.EA.micStatus,f.next=8,mr({video:Ae.Uh.videodeviceId?{deviceId:Ae.Uh.videodeviceId,width:{ideal:((a=Ae.Uh.videoRatio)===null||a===void 0?void 0:a.width)||640},height:{ideal:((n=Ae.Uh.videoRatio)===null||n===void 0?void 0:n.height)||360},frameRate:{min:15,ideal:24}}:!0,audio:Ae.Uh.audiodeviceId?{deviceId:Ae.Uh.audiodeviceId}:!0});case 8:if(l=f.sent,l.getAudioTracks().map(function(b){return b!==null&&(b.enabled=c==="on")}),l.getVideoTracks().map(function(b){return b!==null&&(b.enabled=s==="on")}),f.t0=l,!f.t0){f.next=15;break}return f.next=15,this.qnClient.pushStream({type:"MAJOR",mode:"SFU_SHARING",videoStatus:s,micStatus:c,stream:l});case 15:return(0,N.mr)(C()({},"".concat(E.EA.account,"_MAJOR_video"),{stream:(0,Pt.iH)(l)})),(0,N.mr)(C()({},"".concat(E.EA.account,"_MAJOR_audio"),{stream:(0,Pt.iH)(l)})),f.abrupt("return",Promise.resolve(!0));case 20:return f.prev=20,f.t1=f.catch(1),f.abrupt("return",Promise.reject(!1));case 23:case"end":return f.stop()}},r,this,[[1,20]])}));function e(){return t.apply(this,arguments)}return e}()},{key:"stopPublishStream",value:function(){this.qnClient&&(this.qnClient.stopPushStream(),N.Er.producersStream={})}},{key:"updateParticipantsList",value:function(){var t=k()(h()().mark(function r(){var a,n;return h()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,(a=this.qnClient)===null||a===void 0?void 0:a.getParticipantsList({searchType:"list"});case 2:n=c.sent,(0,N.Jm)(ke()(n.filter(function(l){return l.account!==E.EA.account})));case 4:case"end":return c.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"getPublisherParticipant",value:function(){var t=k()(h()().mark(function r(){var a,n=this,s,c,l,m,f,b;return h()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return console.log("qnbase | getPublisherParticipant | start | \u66F4\u65B0\u63A8\u6D41\u8005\u5217\u8868 ... ..."),R.next=3,(a=this.qnClient)===null||a===void 0?void 0:a.getParticipantsList({searchType:"publisher"});case 3:s=R.sent,c=void 0,l=null,m=null,f=null,b=[],s.map(function(L){var O="MAJOR";L.role==="MODERATOR"&&(f=L),L.handStatus==="speaker"||L.shareStatus==="on"||L.terminalType!=="HDC"?L.handStatus==="speaker"?m=K()(K()({},L),{},{streamType:"MAJOR"}):L.shareStatus==="on"?(l=K()(K()({},L),{},{streamType:"MAJOR"}),O="SHARING"):(O="MAJOR",b.push(K()(K()({},L),{},{streamType:"MAJOR"}))):(O="MINOR",b.push(K()(K()({},L),{},{streamType:"MINOR"}))),L.account!==E.EA.account&&n.subscribeStream(L,"audio",O)}),f&&(c="".concat(f.account,"_MAJOR")),m&&(c="".concat(m.account,"_MAJOR"),b.unshift(m),m.shareStatus==="on"&&(c="".concat(m.account,"_SHARING"))),l&&(c="".concat(l.account,"_SHARING"),b.unshift(l),console.log("frontViewAccount | \u5171\u4EAB\u4EBAfrontView ---> "+c),(0,N.hw)(c)),(0,N.pn)(c||"".concat(E.EA.account,"_MAJOR")),(0,N.KU)([].concat(b));case 15:case"end":return R.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"subscribeStream",value:function(){var t=k()(h()().mark(function r(a,n,s){var c,l,m=this,f,b,D,R;return h()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(this.qnClient){O.next=2;break}return O.abrupt("return");case 2:if(console.log("\u5F00\u59CB\u62C9\u6D41 meeting?.consumersStream: ",N.Er===null||N.Er===void 0?void 0:N.Er.consumersStream),!(N.Er!==null&&N.Er!==void 0&&(c=N.Er.consumersStream)!==null&&c!==void 0&&c["".concat(a.account,"_").concat(s||a.streamType,"_").concat(n)])){O.next=5;break}return O.abrupt("return");case 5:if(this._pullTransport){O.next=7;break}return O.abrupt("return");case 7:if(console.log("\u5F00\u59CB\u62C9\u6D41 ".concat(a.account,"_").concat(s||a.streamType,"_").concat(n)),f=a.account,b=a.streams,D=((l=b.filter(function(F){return F.streamType===s})[0])===null||l===void 0?void 0:l.publishId)||void 0,D){O.next=12;break}return O.abrupt("return");case 12:return R={uid:f,kind:n,type:s,publishId:D,streamMode:"SFU_SHARING"},O.abrupt("return",this.qnClient.pullStream(R).then(function(F){var ie=new MediaStream;return F.track&&ie.addTrack(F.track),(0,N._h)(C()({},"".concat(f,"_").concat(s,"_").concat(n),{stream:(0,Pt.iH)(ie)})),ie}).catch(function(F){m.qnClient&&m.qnClient.stopPullStream({account:f,kind:n,type:s}),console.log("\u62C9\u6D41\u5931\u8D25 - err ",F)}));case 14:case"end":return O.stop()}},r,this)}));function e(r,a,n){return t.apply(this,arguments)}return e}()},{key:"stopSubscribeStream",value:function(){var t=k()(h()().mark(function r(a,n,s){var c=this,l,m;return h()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(this.qnClient){b.next=2;break}return b.abrupt("return");case 2:if(l=function(R){var L;(L=N.Er.consumersStream)!==null&&L!==void 0&&L["".concat(a,"_").concat(R,"_").concat(n)]&&(0,N.Ul)("".concat(a,"_").concat(R,"_").concat(n)),c.qnClient&&c.qnClient.stopPullStream({account:a,kind:n,type:R})},!s){b.next=6;break}return l(s),b.abrupt("return");case 6:m=["MAJOR","MINOR","SHARING"],[].concat(m).map(function(){var D=k()(h()().mark(function R(L){return h()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:l(L);case 1:case"end":return F.stop()}},R)}));return function(R){return D.apply(this,arguments)}}());case 8:case"end":return b.stop()}},r,this)}));function e(r,a,n){return t.apply(this,arguments)}return e}()},{key:"leaveRoom",value:function(){var t=k()(h()().mark(function r(){var a,n=arguments;return h()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(a=n.length>0&&n[0]!==void 0?n[0]:!1,this.qnClient){c.next=3;break}return c.abrupt("return");case 3:if(c.prev=3,this.stopPublishStream(),!a){c.next=10;break}return c.next=8,this.qnClient.leaveRoom();case 8:return c.next=10,this.qnClient._accessOut();case 10:this.resettingData(),c.next=16;break;case 13:c.prev=13,c.t0=c.catch(3),this.resettingData();case 16:case"end":return c.stop()}},r,this,[[3,13]])}));function e(){return t.apply(this,arguments)}return e}()},{key:"resettingData",value:function(){sessionStorage.removeItem("roomInfoWithin"),sessionStorage.removeItem("wsUrlAddresses"),sessionStorage.removeItem("isReconnected"),(0,E.mv)(),(0,N.iL)(),this.network_state=ht.Tb.CLOSED,this.qnClient&&this.qnClient.releaseMediaResources(),gt.m8.replace("/guidePage/"+ot.lf.shortLink+"/joinroom")}},{key:"listenQnClientEvent",value:function(){var e=this;this.qnClient&&this.qnClient.on("switch_device",function(){var r=k()(h()().mark(function a(n,s){var c,l,m,f,b;return h()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(!(s.targets.length>0)){R.next=10;break}return R.next=3,(c=e.qnClient)===null||c===void 0?void 0:c.getParticipantsList({searchType:"exact",targetIds:[s.targets]});case 3:l=R.sent,m=We()(l,1),f=m[0],s.type==="audio"&&(f.micStatus=s.status),s.type==="video"&&(f.videoStatus=s.status),f.account===E.EA.account?(e.qnClient&&e.qnClient.switchDevice("".concat(f.account,"_").concat(s.type,"_MAJOR"),s.type,s.status),(0,E.Il)(f)):(b=N.Er.publishParticipantsList.find(function(L){return L.account===f.account}),(0,N.Fs)(f.account,K()(K()({},f),{},{streamType:b.streamType}))),E.EA.memberStatus&&e.updateParticipantsList();case 10:case"end":return R.stop()}},a)}));return function(a,n){return r.apply(this,arguments)}}()),this.qnClient&&this.qnClient.on("participant_change",function(){var r=k()(h()().mark(function a(n,s){return h()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(s.type==="join"&&s.user.account!==E.EA.account&&e.updateParticipantsList(),!["leave","evicted"].includes(s.type)){l.next=9;break}if(s.uuid!==E.EA.account){l.next=7;break}return e.leaveRoom(),l.abrupt("return",s.type==="evicted"&&(0,Bt.cU)({content:"\u60A8\u5DF2\u88AB\u4E3B\u6301\u4EBA\u8E22\u51FA\u4F1A\u8BAE",okText:"\u77E5\u9053\u4E86"}));case 7:["audio","video"].map(function(m){return e.stopSubscribeStream(s.uuid,m)}),e.updateParticipantsList();case 9:case"end":return l.stop()}},a)}));return function(a,n){return r.apply(this,arguments)}}()),this.qnClient&&this.qnClient.on("participant_stream_change",function(){var r=k()(h()().mark(function a(n,s){return h()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(s.type==="add"&&(e.getPublisherParticipant(),s.streams.map(function(){var m=k()(h()().mark(function f(b){var D,R,L,O;return h()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(b.streamType!=="SHARING"){ie.next=8;break}return ie.next=3,(D=e.qnClient)===null||D===void 0?void 0:D.getParticipantsList({searchType:"exact",targetIds:[s.uuid]});case 3:R=ie.sent,L=We()(R,1),O=L[0],console.log("\u63A8\u6D41\u901A\u77E5 - value",O),e.subscribeStream(O,"video",b.streamType);case 8:case"end":return ie.stop()}},f)}));return function(f){return m.apply(this,arguments)}}()),console.log("participant_stream_change - params -->",s)),s.type!=="delete"){l.next=4;break}return l.next=4,e.stopSubscribeStream(s.uuid,"audio",s.streamType);case 4:case"end":return l.stop()}},a)}));return function(a,n){return r.apply(this,arguments)}}()),this.qnClient&&this.qnClient.on("room_notification",function(){var r=k()(h()().mark(function a(n,s){var c,l,m,f,b,D,R,L,O,F,ie,A,le,je,pe,ye,Be,Ge;return h()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(["raiseHand","putDownHand"].includes(n)&&(s.sourceId===E.EA.account&&(0,E.Il)({handStatus:"up"}),n==="putDownHand"&&s.targetId===E.EA.account&&(0,E.Il)({handStatus:"down"}),E.EA.memberStatus&&e.updateParticipantsList()),n!=="setRollCallNotify"){G.next=11;break}if(!(E.EA.userInfo&&E.EA.account===s.targetId)){G.next=9;break}return Le.ZP.info("\u60A8\u5DF2\u6210\u4E3A\u53D1\u8A00\u4EBA"),(0,E.Il)({handStatus:"speaker"}),G.next=7,e.switchAudioInputState(!0);case 7:G.next=10;break;case 9:E.EA.memberStatus&&e.updateParticipantsList();case 10:e.getPublisherParticipant();case 11:if(n!=="endRollCallNotify"){G.next=24;break}if(!(E.EA.userInfo&&E.EA.account===s.targetId)){G.next=16;break}(0,E.Il)({handStatus:"down"}),G.next=23;break;case 16:return G.next=18,(c=e.qnClient)===null||c===void 0?void 0:c.getParticipantsList({searchType:"exact",targetIds:[s.targetId]});case 18:l=G.sent,m=We()(l,1),f=m[0],f&&(f==null?void 0:f.role)!=="SUBSCRIBER"&&(0,N.Fs)(f.account,K()({},f)),E.EA.memberStatus&&e.updateParticipantsList();case 23:e.getPublisherParticipant();case 24:if(n!=="replaceRollCallNotify"){G.next=44;break}if(b=s.roleChange,D=s.setAudioStatus,R=s.endTargetId,L=s.startTargetId,b&&e.roleChange(b),!(L&&R)){G.next=43;break}if(O=void 0,![R,L].includes(E.EA.account)){G.next=38;break}if(F=E.EA.handStatus==="speaker"?"down":"speaker",F==="speaker"&&Le.ZP.warning("\u60A8\u5DF2\u6210\u4E3A\u53D1\u8A00\u4EBA"),(0,E.Il)({handStatus:F}),G.t0=F==="speaker",!G.t0){G.next=37;break}return G.next=37,e.switchAudioInputState(!0);case 37:O=L;case 38:ie=(N.Er===null||N.Er===void 0?void 0:N.Er.publishParticipantsList.find(function(Ue){return Ue.account===L}))||void 0,A=(N.Er===null||N.Er===void 0?void 0:N.Er.publishParticipantsList.find(function(Ue){return Ue.account===R}))||void 0,ie&&(ie==null?void 0:ie.handStatus)==="speaker"&&(O=L,(0,N.Fs)(L,K()(K()({},ie),{},{handStatus:"down"}))),A&&(A==null?void 0:A.handStatus)==="down"&&(0,N.Fs)(R,K()(K()({},A),{},{handStatus:"speaker"})),O&&(0,N.pn)("".concat(O,"_MAJOR"));case 43:e.positionChange();case 44:if(n==="closeRoomNotify"&&e._roomState==="connected"&&(e._roomState="close",Le.ZP.warning("\u4F1A\u8BAE\u5DF2\u7ED3\u675F"),e.leaveRoom(!0)),n==="setMuteAllNotify"&&(s.quietStatusInRoom==="off"&&E.EA.userInfo&&(0,E.Il)({micStatus:s.quietStatusInRoom}),N.Er.publishParticipantsList.map(function(Ue){Ue.role!=="MODERATOR"&&(0,N.Fs)(Ue.account,K()(K()({},Ue),{},{micStatus:s.quietStatusInRoom}))}),E.EA.memberStatus&&e.updateParticipantsList()),n==="applyShareNotify"&&((0,N.OB)(s.shareType),s.shareId===E.EA.account))try{e.qnClient&&e.qnClient.startSharing((le=N.Er.producersStream)===null||le===void 0?void 0:le["".concat(E.EA.account,"_SHARING")].stream,{micStatus:"on"}),(0,E.Il)({shareStatus:"on"}),(0,N.pn)("".concat(s.shareId,"_SHARING")),(0,N.hw)("".concat(s.shareId,"_SHARING"))}catch(Ue){Ue.name==="NotSupportedError"&&(0,Bt.cU)({content:"\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u5C4F\u5E55\u5171\u4EAB, \u5EFA\u8BAE\u4F7F\u7528Chrome\u6D4F\u89C8\u5668",okText:"\u786E\u5B9A",onOk:function(){}}),e.qnClient&&e.qnClient.endShare(),e.qnClient&&e.qnClient.endSharing()}n==="endShareNotify"&&((0,N.OB)(0),(0,N.hw)(""),s.shareId===E.EA.account?(e.qnClient&&e.qnClient.endSharing(),(0,E.Il)({shareStatus:"off"})):["video","audio"].map(function(Ue){return e.stopSubscribeStream(s.shareId,Ue,"SHARING")}),e.getPublisherParticipant()),n==="setPartSelfDismissMuteNotify"&&(0,N.aP)({allowPartDismissMute:s.allowPartDismissMute}),n==="pollingToNotify"&&(je=s.targetId,pe=e.qnClient&&e.qnClient.getProducer("".concat(E.EA.account,"_video_MAJOR")),je===E.EA.account?pe&&pe.paused&&pe.resume():pe&&!pe.paused&&E.EA.cameraStatus==="off"&&pe.pause()),n==="stopPollingNotify"&&(ye=e.qnClient&&e.qnClient.getProducer("".concat(E.EA.account,"_video_MAJOR")),ye&&!ye.paused&&E.EA.cameraStatus==="off"&&ye.pause()),n==="partOrderOrRoleChangeNotify"&&(Be=s.roleChange,Ge=s.setAudioStatus,Be&&Be.length&&e.roleChange(Be),e.positionChange()),n==="userBreakLine"&&(["audio","video"].map(function(Ue){return e.stopSubscribeStream(s.uuid,Ue)}),e.getPublisherParticipant(),e.updateParticipantsList());case 53:case"end":return G.stop()}},a)}));return function(a,n){return r.apply(this,arguments)}}())}},{key:"roleChange",value:function(e){var r=this;e.forEach(function(){var a=k()(h()().mark(function n(s){var c,l,m;return h()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:c=s.uuid,l=s.originalRole,m=s.presentRole,["MODERATOR","PUBLISHER"].includes(l)&&m==="SUBSCRIBER"&&(c===E.EA.account?((0,E.Il)({role:m}),r.stopPublishStream()):["audio","video"].map(function(D){r.stopSubscribeStream(c,D)})),["MODERATOR","PUBLISHER"].includes(m)&&l==="SUBSCRIBER"&&E.EA.account===c&&((0,E.Il)({role:m}),r.publishStream());case 3:case"end":return b.stop()}},n)}));return function(n){return a.apply(this,arguments)}}())}},{key:"positionChange",value:function(){this.getPublisherParticipant(),E.EA.memberStatus&&this.updateParticipantsList()}},{key:"networkReconnect",value:function(){this.qnClient&&this.qnClient.networkReconnect()}},{key:"endShare",value:function(){this.qnClient&&this.qnClient.endShare()}},{key:"replaceTrack",value:function(){var t=k()(h()().mark(function r(a){var n,s;return h()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.qnClient){l.next=2;break}return l.abrupt("return");case 2:if(a){l.next=4;break}return l.abrupt("return");case 4:return l.next=6,this.getReplaceTrack(a);case 6:return n=l.sent,l.next=9,this.qnClient.replaceTrack("".concat(E.EA.account,"_").concat(a,"_MAJOR"),n);case 9:s=new MediaStream,s.addTrack(n),(0,N.mr)(C()({},"".concat(E.EA.account,"_MAJOR_").concat(a),{stream:(0,Pt.iH)(s)}));case 12:case"end":return l.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e}()},{key:"getReplaceTrack",value:function(){var t=k()(h()().mark(function r(a){return h()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(a!=="audio"){s.next=4;break}return s.next=3,this.replaceAudioTrack();case 3:return s.abrupt("return",s.sent);case 4:if(a!=="video"){s.next=8;break}return s.next=7,this.replaceVideoTrack();case 7:return s.abrupt("return",s.sent);case 8:return s.abrupt("return",void 0);case 9:case"end":return s.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e}()},{key:"replaceVideoTrack",value:function(){var t=k()(h()().mark(function r(){var a,n,s;return h()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,hr({deviceId:Ae.Uh.videodeviceId,width:{ideal:((a=Ae.Uh.videoRatio)===null||a===void 0?void 0:a.width)||640},height:{ideal:((n=Ae.Uh.videoRatio)===null||n===void 0?void 0:n.height)||360},frameRate:{min:15,ideal:24}});case 2:return s=l.sent,l.abrupt("return",s);case 4:case"end":return l.stop()}},r)}));function e(){return t.apply(this,arguments)}return e}()},{key:"replaceAudioTrack",value:function(){var t=k()(h()().mark(function r(){var a;return h()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,pr({deviceId:Ae.Uh.audiodeviceId});case 2:return a=s.sent,s.abrupt("return",a);case 4:case"end":return s.stop()}},r)}));function e(){return t.apply(this,arguments)}return e}()}]),u}(wt.v),vr=fr,_r=function(i){return new vr(i)},gr=_r,Dt=g(95099);function wr(o){return Ut.apply(this,arguments)}function Ut(){return Ut=k()(h()().mark(function o(i){var u,t,e,r,a,n,s,c,l,m;return h()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return u=i.phone,t={account:u.trim(),type:"phone",usage:"BindPhone",uuid:E.EA.account},e=new Date,r=e.valueOf(),a=e.getFullYear(),n=e.getMonth()>8?e.getMonth()+1:"0".concat(e.getMonth()+1),s=(0,ve.MD5)(JSON.stringify(t)).toString().toLowerCase(),c=(0,oe.O1)(32),l=(0,ve.MD5)("".concat(u,"_GeeDowTech_").concat(a).concat(n)).toString().toLowerCase(),m=`POST
/api/voip/v1/touristValidate/code
`.concat(s,`
application/json
X-Sd-Account:`).concat(t.uuid,`
X-Sd-Apiver:1.0
X-Sd-Nonce:`).concat(c,`
X-Sd-Timestamp:`).concat(r,`
`),b.abrupt("return",(0,Ne.Z)("/api/voip/v1/touristValidate/code",{method:"POST",headers:{"Content-MD5":s,"Content-Type":"application/json","X-Sd-Account":"".concat(E.EA.account),"X-Sd-Apiver":"1.0","X-Sd-Nonce":c,"X-Sd-Timestamp":r,"X-Sd-Signature":x().stringify((0,ve.HmacSHA256)(m,l))},data:t}));case 11:case"end":return b.stop()}},o)})),Ut.apply(this,arguments)}function kr(o){return $t.apply(this,arguments)}function $t(){return $t=k()(h()().mark(function o(i){var u,t,e,r,a,n,s,c,l,m,f;return h()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return u=i.phone,t=i.SMSCode,e={account:u,type:"phone",usage:"BindPhone",validateCode:t},r=new Date,a=r.valueOf(),n=r.getFullYear(),s=r.getMonth()>8?r.getMonth()+1:"0".concat(r.getMonth()+1),c=(0,ve.MD5)(JSON.stringify(e)).toString().toLowerCase(),l=(0,oe.O1)(32),m=(0,ve.MD5)("".concat(u,"_GeeDowTech_").concat(n).concat(s)).toString().toLowerCase(),f=`POST
/api/voip/v1/touristValidate/verify
`.concat(c,`
application/json
X-Sd-Account:`).concat(E.EA.account,`
X-Sd-Apiver:1.0
X-Sd-Nonce:`).concat(l,`
X-Sd-Timestamp:`).concat(a,`
`),D.abrupt("return",(0,Ne.Z)("/api/voip/v1/touristValidate/verify",{method:"POST",data:e,headers:{"Content-MD5":c,"Content-Type":"application/json","X-Sd-Account":"".concat(E.EA.account),"X-Sd-Apiver":"1.0","X-Sd-Nonce":l,"X-Sd-Timestamp":a,"X-Sd-Signature":x().stringify((0,ve.HmacSHA256)(f,m))}}));case 11:case"end":return D.stop()}},o)})),$t.apply(this,arguments)}function yr(o){return Ft.apply(this,arguments)}function Ft(){return Ft=k()(h()().mark(function o(i){var u,t,e,r,a,n,s,c,l;return h()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return u={mac:"A1:A1:45:C5:D2:E9",platform:"web",username:i.userName},t=new Date,e=t.valueOf(),r=t.getFullYear(),a=t.getMonth()>8?t.getMonth()+1:"0".concat(t.getMonth()+1),n=(0,ve.MD5)(JSON.stringify(u)).toString().toLowerCase(),s=(0,oe.O1)(32),c=(0,ve.MD5)("".concat(u.mac,"_GeeDowTech_").concat(r).concat(a)).toString().toLowerCase(),l=`POST
/api/voip/v1/tourist/login
`.concat(n,`
application/json
X-Sd-Apiver:1.0
X-Sd-Nonce:`).concat(s,`
X-Sd-Timestamp:`).concat(e,`
`),f.abrupt("return",(0,Ne.Z)("/api/voip/v1/tourist/login",{method:"POST",headers:{"Content-MD5":n,"Content-Type":"application/json","X-Sd-Apiver":"1.0","X-Sd-Nonce":s,"X-Sd-Timestamp":e,"X-Sd-Signature":x().stringify((0,ve.HmacSHA256)(l,c))},data:u}).then(function(b){return(0,oe.po)("login_info",b.data.result),Promise.resolve(b.data)}).catch(function(b){return Promise.reject(b.data)}));case 10:case"end":return f.stop()}},o)})),Ft.apply(this,arguments)}function Sr(){return Wt.apply(this,arguments)}function Wt(){return Wt=k()(h()().mark(function o(){return h()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Qe.post("/voip/v1/lookup/signal/address",{}));case 1:case"end":return u.stop()}},o)})),Wt.apply(this,arguments)}var br=function(i){var u,t,e,r=i.isReconnected,a=i.password,n;return(u=window)!==null&&u!==void 0&&u.QNClient&&((t=window)===null||t===void 0?void 0:t.QNClient.network_state)==="CONNECTED"?(n=window.QNClient,new Promise(function(s,c){var l,m,f;(l=n.joinRoom({roomId:(m=ot.lf.roomInfo)===null||m===void 0?void 0:m.roomId,nickname:E.EA.nickName,account:E.EA.account,micStatus:Ae.Uh.micDevice.enabled==="mute"?"off":"on",videoStatus:Ae.Uh.cameraDevice.enabled==="mute"?"off":"on",password:((f=N.Er.roomInfo)===null||f===void 0?void 0:f.password)||a||void 0,isReconnected:r||N.Er.isReconnected}))===null||l===void 0||l.then(function(b){var D;if(console.log("joinRoom() | Client | Client.joinRoom() | res",b),(0,N.pK)(!1),(0,ot.Ni)(!1),(b==null||(D=b.roomInfo)===null||D===void 0?void 0:D.lock)==="on")return(0,Dt.mZ)();gt.m8.replace("/meeting"),Ae.Uh.deviceAuthority&&n.publishStream(),s(!0)}).catch(function(b){if(console.log("error_res ---> ",b),b!=null&&b.code){if(b.code===13002)return(0,Dt.mZ)();if(b.code===13006){N.Er.passwordModal&&Le.ZP.error(b.message),(0,N.pK)(!0);return}if(b.code===13001)return~location.pathname.indexOf("meeting")&&gt.m8.replace("/guidePage/"+ot.lf.shortLink+"/joinroom"),console.error("\u4F1A\u8BAE\u4E0D\u5B58\u5728"),Le.ZP.warning("\u4F1A\u8BAE\u4E0D\u5B58\u5728")}n&&n.leaveRoom(),c(b)})})):(n=gr({account:E.EA.account,token:E.EA.token,nickName:E.EA.nickName,urls:N.Er.wsUrlAddresses,roomId:(e=ot.lf.roomInfo)===null||e===void 0?void 0:e.roomId,role:"PUBLISHER",conferenceMode:"SFU"}),new Promise(function(s,c){var l;window.QNClient=n,console.log("\u8FD9\u91CCo ... ..."),(l=n.qnClient)===null||l===void 0||l.on("network_state",function(m){if(m==="CONNECTED"){var f,b,D;(f=n.joinRoom({roomId:(b=ot.lf.roomInfo)===null||b===void 0?void 0:b.roomId,nickname:E.EA.nickName,account:E.EA.account,micStatus:Ae.Uh.micDevice.enabled==="mute"?"off":"on",videoStatus:Ae.Uh.cameraDevice.enabled==="mute"?"off":"on",password:((D=N.Er.roomInfo)===null||D===void 0?void 0:D.password)||void 0,isReconnected:r||N.Er.isReconnected}))===null||f===void 0||f.then(function(R){var L;if(console.log("joinRoom() | Client | Client.joinRoom() | res",R),(0,ot.Ni)(!1),((L=R.roomInfo)===null||L===void 0?void 0:L.lock)==="on")return(0,Dt.mZ)();gt.m8.replace("/meeting"),Ae.Uh.deviceAuthority&&n.publishStream(),s(!0)}).catch(function(R){if(console.log("error_res ---> ",R),R!=null&&R.code){if(R.code===13002)return(0,Dt.mZ)();if(R.code===13006){N.Er.passwordModal&&Le.ZP.error(R.message),(0,N.pK)(!0);return}if(R.code===13001)return~location.pathname.indexOf("meeting")&&gt.m8.replace("/guidePage/"+ot.lf.shortLink+"/joinroom"),console.error("\u4F1A\u8BAE\u4E0D\u5B58\u5728"),Le.ZP.warning("\u4F1A\u8BAE\u4E0D\u5B58\u5728")}Le.ZP.error(R.message),n&&n.leaveRoom(),c(R)})}})}))}},95099:function(ut,Me,g){g.d(Me,{Bi:function(){return Ie},HS:function(){return Ee},Hg:function(){return Ke},Hv:function(){return tt},Pz:function(){return ae},U5:function(){return ct},cK:function(){return K},cZ:function(){return ce},cz:function(){return ke},d0:function(){return We},l0:function(){return Qe},mZ:function(){return z},ss:function(){return he},vM:function(){return ze},wK:function(){return P},wM:function(){return Fe}});var Je=g(9783),h=g.n(Je),Ve=g(15009),k=g.n(Ve),Ne=g(99289),ve=g.n(Ne),ge=g(84424),x=g(60247),oe=g(27307),ue=g(23089),Ce=g(58301),we=g(86949),J=g(79095),E=new oe.Yd("sdk-tools"),Ke=function(){var Q=ve()(k()().mark(function U(){var j;return k()().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return de.next=2,oe.yQ.getAudioInputDevices();case 2:j=de.sent,(0,J.qj)((0,we.iH)(j));case 4:case"end":return de.stop()}},U)}));return function(){return Q.apply(this,arguments)}}(),Ee=function(){var Q=ve()(k()().mark(function U(){var j;return k()().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return de.next=2,oe.yQ.getAudioOutputDevices();case 2:j=de.sent,(0,J.Rv)((0,we.iH)(j));case 4:case"end":return de.stop()}},U)}));return function(){return Q.apply(this,arguments)}}(),Qe=function(){var Q=ve()(k()().mark(function U(){var j;return k()().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return de.next=2,oe.yQ.getCameraDevices();case 2:j=de.sent,(0,J.dg)((0,we.iH)(j));case 4:case"end":return de.stop()}},U)}));return function(){return Q.apply(this,arguments)}}();oe.yQ.on("MEDIA_DEVICE_CHANGED",function(Q,U){Q==="videoinput"&&(Qe(),U===J.Uh.videodeviceId&&(0,J.Ns)("")),Q==="audioinput"&&(Ke(),U===J.Uh.audiodeviceId&&(0,J.Cv)("")),Q==="audiooutput"&&(Ee(),(0,J.nO)(""))});var Ie=function(){return navigator.permissions.query({name:"microphone"}).then(function(U){console.log("\u8BBE\u5907\u6743\u9650 - audio",U);var j=U.state==="granted";return{audio:j}})},ke=function(){return navigator.permissions.query({name:"camera"}).then(function(U){console.log("\u8BBE\u5907\u6743\u9650 - video",U);var j=U.state==="granted";return{video:j}})},Fe=function(U){var j,C;console.log("[sdk]: tools | openOrCloseMediaDevice() | type : "+U),(j=window)!==null&&j!==void 0&&j.QNClient&&(console.log("[sdk]: tools | openOrCloseMediaDevice() | QNClient : ",(C=window)===null||C===void 0?void 0:C.QNClient),U==="audio"&&window.QNClient.switchAudioInputState(),U==="video"&&window.QNClient.switchVideoInputState())},We=function(U){var j;if((j=window)!==null&&j!==void 0&&j.QNClient)switch(console.log("sdk | tools | checkRaiseSpeakStatus | type : "+U),U){case"down":window.QNClient.qnClient.raiseHand();return;case"up":window.QNClient.qnClient.putDownHand();return;case"speaker":window.QNClient.qnClient.endRollCall();return}},ze=function(){var Q=ve()(k()().mark(function U(){var j,C,de,qe;return k()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if(window.QNClient){re.next=2;break}return re.abrupt("return");case 2:if(de=(ge.Er===null||ge.Er===void 0||(j=ge.Er.publishParticipantsList)===null||j===void 0?void 0:j.find(function($e){return"".concat($e.account,"_SHARING")==ge.Er.shareAccount}))||void 0,!(((C=ge.Er.shareAccount)===null||C===void 0?void 0:C.split("_")[0])!==x.EA.account&&de)){re.next=5;break}return re.abrupt("return",Ce.ZP.warning("".concat(de==null?void 0:de.username,"\u6B63\u5728\u5171\u4EAB\uFF0C\u6B64\u65F6\u65E0\u6CD5\u53D1\u8D77\u5171\u4EAB")));case 5:if(x.EA.shareStatus!=="on"){re.next=12;break}return re.next=8,(0,oe.lS)({audio:!0,video:!0});case 8:qe=re.sent,window.QNClient.qnClient.reSharing(qe),re.next=13;break;case 12:(0,oe.lS)({audio:!0,video:!0}).then(function($e){(0,ge.mr)(h()({},"".concat(x.EA.account,"_SHARING"),{stream:(0,we.iH)($e)})),window.QNClient.qnClient.applyShare()}).catch(function($e){~$e.toString().indexOf("NotAllowedError: Permission denied")||(["NotSupportedError","NotAllowedError"].includes($e==null?void 0:$e.name)&&(0,ue.cU)({content:"\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u5C4F\u5E55\u5171\u4EAB, \u5EFA\u8BAE\u4F7F\u7528Chrome\u6D4F\u89C8\u5668",okText:"\u786E\u5B9A",onOk:function(){console.log("\u5173\u95ED \u5F53\u524D\u4E0D\u652F\u6301\u5171\u4EAB\u5C4F\u5E55 \u786E\u8BA4\u6846")}}),window.QNClient.qnClient&&window.QNClient.qnClient.endSharing())});case 13:case"end":return re.stop()}},U)}));return function(){return Q.apply(this,arguments)}}(),K=function(){window.QNClient&&window.QNClient.endShare()},tt=function(){var Q=ve()(k()().mark(function U(j,C,de){var qe;return k()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if(window.QNClient){re.next=2;break}return re.abrupt("return");case 2:return re.next=4,window.QNClient.subscribeStream(j,C,de);case 4:return qe=re.sent,re.abrupt("return",qe);case 6:case"end":return re.stop()}},U)}));return function(j,C,de){return Q.apply(this,arguments)}}(),ce=function(U,j,C){window.QNClient&&window.QNClient.stopSubscribeStream(U,j,C)},ct=function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;oe.yQ&&oe.yQ.removeAllListeners(),window.QNClient&&window.QNClient.leaveRoom(U)},he=function(){window.QNClient&&window.QNClient.networkReconnect()},ae=function(U){window.QNClient&&window.QNClient.replaceTrack(U)},P=function(){window.QNClient&&window.QNClient.updateParticipantsList()},z=function(){return(0,ue.cU)({content:"\u4F1A\u8BAE\u5DF2\u9501\u5B9A\uFF0C\u5982\u9700\u52A0\u5165\u8BF7\u8054\u7CFB\u4E3B\u6301\u4EBA",okText:"\u6211\u77E5\u9053\u4E86",onOk:function(){window.QNClient&&window.QNClient.leaveRoom(!0)}})},q=function(){window.QNClient&&window.QNClient.publishStream()}},84424:function(ut,Me,g){g.d(Me,{BZ:function(){return ue},Er:function(){return x},Fs:function(){return Ee},Hi:function(){return we},Iq:function(){return ce},Jm:function(){return Ie},KU:function(){return Ke},OB:function(){return oe},Ul:function(){return K},_h:function(){return ze},aP:function(){return Ce},fX:function(){return tt},hw:function(){return Fe},iL:function(){return he},mr:function(){return We},pK:function(){return E},pn:function(){return ke},yC:function(){return ct}});var Je=g(19632),h=g.n(Je),Ve=g(97857),k=g.n(Ve),Ne=g(86949),ve=g(66419),ge=g(56324),x=(0,Ne.sj)({roomInfo:(0,ve.cF)("roomInfoWithin")||void 0,wsUrlAddresses:(0,ve.cF)("wsUrlAddresses")||[],isReconnected:(0,ve.cF)("isReconnected")||!1,passwordModal:!1,participantsList:[],publishParticipantsList:[],frontViewAccount:"",shareAccount:"",producersStream:{},consumersStream:{},page:0,networkState:ge.Tb.IDEL,isVoiceMode:!1,shareType:0}),oe=function(P){x.shareType=P},ue=function(P){x.networkState=P},Ce=function(P){x.roomInfo=k()(k()({},x.roomInfo),P)},we=function(P){x.wsUrlAddresses=h()(P)},J=function(P){x.isReconnected=P,setStorage("isReconnected",P)},E=function(P){x.passwordModal=P},Ke=function(P){x.publishParticipantsList=h()(P),console.log(" meeting | updatepublishParticipantsListAll | publishParticipantsList",x.publishParticipantsList)},Ee=function(P,z){var q=x.publishParticipantsList.findIndex(function(U){return U.account===P});if(!(q<0)){var Q=x.publishParticipantsList;Q.splice(q,1,z),console.log("\u66F4\u65B0\u53C2\u4F1A\u8005\u5217\u8868 | temp ----> ",Q),x.publishParticipantsList=h()(Q)}},Qe=function(P){x.publishParticipantsList=x.publishParticipantsList.filter(function(z){return z.account!=P})},Ie=function(P){x.participantsList=P},ke=function(P){x.frontViewAccount=P},Fe=function(P){x.shareAccount=P},We=function(P){x.producersStream=k()(k()({},x.producersStream),P)},ze=function(P){x.consumersStream=k()(k()({},x.consumersStream),P)},K=function(P){delete x.consumersStream[P]},tt=function(P){x.isVoiceMode=P},ce=function(){x.page!==0&&(x.page=x.page-1)},ct=function(){x.page=x.page+1},he=function(){x.roomInfo=void 0,x.participantsList=[],x.publishParticipantsList=[],x.frontViewAccount="",x.shareAccount="",x.producersStream={},x.consumersStream={}}},19092:function(ut,Me){Me.Z={namespace:"namespace___khuLD",deviceSelectedOptions:"deviceSelectedOptions___txjOn",device_selected_inner:"device_selected_inner___S5d6L",device_selected_inner_title:"device_selected_inner_title___suIWM"}}}]);
